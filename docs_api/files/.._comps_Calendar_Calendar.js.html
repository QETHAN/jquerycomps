<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../comps/Calendar/Calendar.js - jquery components</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../jc_logo.png" title="jquery components"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/.window.html">.window</a></li>
            
                <li><a href="../classes/JC.alert.html">JC.alert</a></li>
            
                <li><a href="../classes/JC.Calendar.html">JC.Calendar</a></li>
            
                <li><a href="../classes/JC.confirm.html">JC.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.html">JC.Dialog</a></li>
            
                <li><a href="../classes/JC.Dialog.alert.html">JC.Dialog.alert</a></li>
            
                <li><a href="../classes/JC.Dialog.confirm.html">JC.Dialog.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.mask.html">JC.Dialog.mask</a></li>
            
                <li><a href="../classes/JC.Dialog.msgbox.html">JC.Dialog.msgbox</a></li>
            
                <li><a href="../classes/JC.ExampleClass.html">JC.ExampleClass</a></li>
            
                <li><a href="../classes/JC.Fixed.html">JC.Fixed</a></li>
            
                <li><a href="../classes/JC.Form.html">JC.Form</a></li>
            
                <li><a href="../classes/JC.hideAllPanel.html">JC.hideAllPanel</a></li>
            
                <li><a href="../classes/JC.hideAllPopup.html">JC.hideAllPopup</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.html">JC.LunarCalendar</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.Model.html">JC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.View.html">JC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/JC.msgbox.html">JC.msgbox</a></li>
            
                <li><a href="../classes/JC.Panel.html">JC.Panel</a></li>
            
                <li><a href="../classes/JC.Panel.Model.html">JC.Panel.Model</a></li>
            
                <li><a href="../classes/JC.Panel.View.html">JC.Panel.View</a></li>
            
                <li><a href="../classes/JC.Slider.html">JC.Slider</a></li>
            
                <li><a href="../classes/JC.Slider.Model.html">JC.Slider.Model</a></li>
            
                <li><a href="../classes/JC.Suggest.html">JC.Suggest</a></li>
            
                <li><a href="../classes/JC.Tab.html">JC.Tab</a></li>
            
                <li><a href="../classes/JC.Tab.Model.html">JC.Tab.Model</a></li>
            
                <li><a href="../classes/JC.Tab.View.html">JC.Tab.View</a></li>
            
                <li><a href="../classes/JC.Tips.html">JC.Tips</a></li>
            
                <li><a href="../classes/JC.Tips.Model.html">JC.Tips.Model</a></li>
            
                <li><a href="../classes/JC.Tips.View.html">JC.Tips.View</a></li>
            
                <li><a href="../classes/JC.Tree.html">JC.Tree</a></li>
            
                <li><a href="../classes/JC.Tree.Model.html">JC.Tree.Model</a></li>
            
                <li><a href="../classes/JC.Valid.html">JC.Valid</a></li>
            
                <li><a href="../classes/window.JC.html">window.JC</a></li>
            
                <li><a href="../classes/window.jQuery.html">window.jQuery</a></li>
            
                <li><a href="../classes/window.UXC.html">window.UXC</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../comps/Calendar/Calendar.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function($){
    /**
     * 日期选择组件
     * &lt;br /&gt;全局访问请使用 JC.Calendar 或 Calendar
     * &lt;br /&gt;DOM 加载完毕后
     * , Calendar会自动初始化页面所有日历组件, input[type=text][datatype=date]标签
     * &lt;br /&gt;Ajax 加载内容后, 如果有日历组件需求的话, 需要手动使用Calendar.init( _selector )
     * &lt;br /&gt;_selector 可以是 新加载的容器, 也可以是新加载的所有input
     * &lt;p&gt;&lt;b&gt;require&lt;/b&gt;: &lt;a href=&#x27;window.jQuery.html&#x27;&gt;jQuery&lt;/a&gt;
     * &lt;br /&gt;&lt;b&gt;require&lt;/b&gt;: &lt;a href=&#x27;.window.html#method_cloneDate&#x27;&gt;window.cloneDate&lt;/a&gt;
     * &lt;br /&gt;&lt;b&gt;require&lt;/b&gt;: &lt;a href=&#x27;.window.html#method_parseISODate&#x27;&gt;window.parseISODate&lt;/a&gt;
     * &lt;br /&gt;&lt;b&gt;require&lt;/b&gt;: &lt;a href=&#x27;.window.html#method_formatISODate&#x27;&gt;window.formatISODate&lt;/a&gt;
     * &lt;br /&gt;&lt;b&gt;require&lt;/b&gt;: &lt;a href=&#x27;.window.html#method_maxDayOfMonth&#x27;&gt;window.maxDayOfMonth&lt;/a&gt;
     * &lt;br /&gt;&lt;b&gt;require&lt;/b&gt;: &lt;a href=&#x27;.window.html#method_isSameDay&#x27;&gt;window.isSameDay&lt;/a&gt;
     * &lt;br /&gt;&lt;b&gt;require&lt;/b&gt;: &lt;a href=&#x27;.window.html#method_isSameMonth&#x27;&gt;window.isSameMonth&lt;/a&gt;
     * &lt;/p&gt;
     * &lt;p&gt;&lt;a href=&#x27;https://github.com/openjavascript/jquerycomps&#x27; target=&#x27;_blank&#x27;&gt;JC Project Site&lt;/a&gt;
     * | &lt;a href=&#x27;http://jc.openjavascript.org/docs_api/classes/JC.Calendar.html&#x27; target=&#x27;_blank&#x27;&gt;API docs&lt;/a&gt;
     * | &lt;a href=&#x27;../../comps/Calendar/_demo/&#x27; target=&#x27;_blank&#x27;&gt;demo link&lt;/a&gt;&lt;/p&gt;
     * &lt;h2&gt; 可用的html attribute, (input|button):(datatype|multidate)=(date|week|month|season) &lt;/h2&gt; 
     * &lt;dl&gt;
     *      &lt;dt&gt;datatype&lt;/dt&gt;
     *      &lt;dd&gt;
     *          声明日历控件的类型:
     *          &lt;p&gt;&lt;b&gt;date:&lt;/b&gt; 日期日历&lt;/p&gt;
     *          &lt;p&gt;&lt;b&gt;week:&lt;/b&gt; 周日历&lt;/p&gt;
     *          &lt;p&gt;&lt;b&gt;month:&lt;/b&gt; 月日历&lt;/p&gt;
     *          &lt;p&gt;&lt;b&gt;season:&lt;/b&gt; 级日历&lt;/p&gt;
     *      &lt;/dd&gt;
     *
     *      &lt;dt&gt;multidate&lt;/dt&gt;
     *      &lt;dd&gt;
     *          与 datatype 一样, 这个是扩展属性, 避免表单验证带来的逻辑冲突
     *      &lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarshow&lt;/dt&gt;
     *      &lt;dd&gt;显示日历时的回调&lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarhide&lt;/dt&gt;
     *      &lt;dd&gt;隐藏日历时的回调&lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarlayoutchange&lt;/dt&gt;
     *      &lt;dd&gt;用户点击日历控件操作按钮后, 外观产生变化时触发的回调&lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarupdate&lt;/dt&gt;
     *      &lt;dd&gt;赋值后触发的回调, params: _CalendarType, _startDate, _endDate&lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarclear&lt;/dt&gt;
     *      &lt;dd&gt;清空日期触发的回调&lt;/dd&gt;
     *
     *      &lt;dt&gt;minvalue&lt;/dt&gt;
     *      &lt;dd&gt;日期的最小时间, YYYY-MM-DD&lt;/dd&gt;
     *
     *      &lt;dt&gt;maxvalue&lt;/dt&gt;
     *      &lt;dd&gt;日期的最大时间, YYYY-MM-DD&lt;/dd&gt;
     *
     *      &lt;dt&gt;currentcanselect&lt;/dt&gt;
     *      &lt;dd&gt;当前日期是否能选择, bool, default=true&lt;/dd&gt;
     *
     *      &lt;dt&gt;multiselect (目前只对月份日历有效)&lt;/dt&gt;
     *      &lt;dd&gt;是否为多选日历, bool, default=false&lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarupdatemultiselect&lt;/dt&gt;
     *      &lt;dd&gt;多选日历赋值后触发的回调, params: _CalendarType, _dateArray( [ {start, end}, ... ] )&lt;/dd&gt;
     * &lt;/dl&gt;
     * @namespace JC
     * @class Calendar
     * @static
     * @version dev 0.1
     * @author  qiushaowei   &lt;suches@btbtd.org&gt; | 75 team
     * @date    2013-06-04
     */
    /**
     * //TODO 添加事件响应机制
     */
    var Calendar = JC.Calendar = window.Calendar = 
    {
        /**
         * 弹出日期选择框
         * @method pickDate
         * @static
         * @param   {selector}  _selector 需要显示日期选择框的input[text]   
         * @example
                &lt;dl&gt;
                    &lt;dd&gt;
                        &lt;input type=&quot;text&quot; name=&quot;date6&quot; class=&quot;manualPickDate&quot; value=&quot;20110201&quot; /&gt;
                        manual JC.Calendar.pickDate
                    &lt;/dd&gt;
                    &lt;dd&gt;
                        &lt;input type=&quot;text&quot; name=&quot;date7&quot; class=&quot;manualPickDate&quot; /&gt;
                        manual JC.Calendar.pickDate
                    &lt;/dd&gt;
                &lt;/dl&gt;
                &lt;script&gt;
                    $(document).delegate(&#x27;input.manualPickDate&#x27;, &#x27;focus&#x27;, function($evt){
                    JC.Calendar.pickDate( this );
                    });
                &lt;/script&gt;
         */
        pickDate: 
            function( _selector ){ 
                _selector = $( _selector );
                if( !(_selector &amp;&amp; _selector.length) ) return;
                $(&#x27;body &gt; div.UXCCalendar&#x27;).hide();
                Calendar.lastIpt = _selector;
                _selector = $(_selector);
                var _type = $.trim(_selector.attr(&#x27;multidate&#x27;) || &#x27;&#x27;).toLowerCase() || $.trim(_selector.attr(&#x27;datatype&#x27;) || &#x27;&#x27;).toLowerCase();
                switch( _type ){
                    case &#x27;week&#x27;: Calendar.pickWeek &amp;&amp; Calendar.pickWeek( _selector ); break;
                    case &#x27;month&#x27;: Calendar.pickMonth &amp;&amp; Calendar.pickMonth( _selector ); break;
                    case &#x27;season&#x27;: Calendar.pickSeason &amp;&amp; Calendar.pickSeason( _selector ); break;
                    default: _logic.pickDate( _selector );
                }

                Calendar.layoutInitedCallback &amp;&amp; Calendar.layoutInitedCallback( $(&#x27;body &gt; div.UXCCalendar:visible&#x27;), _selector );
                Calendar._triggerShow();
            } 
        /**
         * 初始化 _selector 中的所有日历组件
         * @method  init
         * @static
         * @param   {selector}  _selector 需要初始化的日历组件父容器/日期选择input选择器
         * @example
                &lt;script&gt;
                    $.post( url, function( _d ){
                        _d = $(_d);
                        _d.appendTo(body);
                        JC.Calendar.init( _d );
                    });
                &lt;/script&gt;
         */
        , init: function( _selector ){ _logic.initTrigger( _selector ); }
        /**
         * 设置是否在 DOM 加载完毕后, 自动初始化所有日期控件
         * @property    autoInit
         * @default true
         * @type    {bool}
         * @static
                &lt;script&gt;JC.Calendar.autoInit = true;&lt;/script&gt;
         */
        , autoInit: true
        /**
         * 设置默认显示的年份数, 该数为前后各多少年 默认为前后各10年
         * @property    defaultDateSpan
         * @type        {int}
         * @default     20
         * @static
                &lt;script&gt;JC.Calendar.defaultDateSpan = 20;&lt;/script&gt;
         */
        , defaultDateSpan: 20
        /**
         * 最后一个显示日历组件的文本框
         * @property  lastIpt
         * @type    selector
         * @static
         */
        , lastIpt: null
        /**
         * 设置日历组件的显示位置
         * @method  setPosition
         * @static
         * @param   {selector}  _ipt    需要显示日历组件的文本框
         */
        , setPosition:
            function( _ipt, _layout ){
                if( !( _ipt &amp;&amp; _layout ) ) return;
                _layout.css( {&#x27;left&#x27;: &#x27;-9999px&#x27;, &#x27;top&#x27;: &#x27;-9999px&#x27;, &#x27;z-index&#x27;: ZINDEX_COUNT++ } ).show();
                var _lw = _layout.width(), _lh = _layout.height()
                    , _iw = _ipt.width(), _ih = _ipt.height(), _ioset = _ipt.offset()
                    , _x, _y, _winw = $(window).width(), _winh = $(window).height()
                    , _scrtop = $(document).scrollTop()
                    ;

                _x = _ioset.left; _y = _ioset.top + _ih + 5;

                if( ( _y + _lh - _scrtop ) &gt; _winh ){
                    JC.log(&#x27;y overflow&#x27;);
                    _y = _ioset.top - _lh - 3;

                    if( _y &lt; _scrtop ) _y = _scrtop;
                }

                _layout.css( {left: _x+&#x27;px&#x27;, top: _y+&#x27;px&#x27;} );

                JC.log( _lw, _lh, _iw, _ih, _ioset.left, _ioset.top, _winw, _winh );
                JC.log( _scrtop, _x, _y );
            }
        /** 
         * 判断选择器是否为日历组件的对象
         * @method  isCalendar
         * @static
         * @param   {selector}  _selector
         * return   bool
         */
        , isCalendar:
            function( _selector ){
                _selector = $(_selector);
                var _r = 0;

                if( _selector.length ){
                    if( _selector.hasClass(&#x27;UXCCalendar_btn&#x27;) ) _r = 1;
                    if( _selector.prop(&#x27;nodeName&#x27;) 
                            &amp;&amp; _selector.attr(&#x27;datatype&#x27;)
                            &amp;&amp; ( _selector.prop(&#x27;nodeName&#x27;).toLowerCase()==&#x27;input&#x27; || _selector.prop(&#x27;nodeName&#x27;).toLowerCase()==&#x27;button&#x27; )
                            &amp;&amp; ( _selector.attr(&#x27;datatype&#x27;).toLowerCase()==&#x27;date&#x27; 
                                    || _selector.attr(&#x27;datatype&#x27;).toLowerCase()==&#x27;week&#x27; 
                                    || _selector.attr(&#x27;datatype&#x27;).toLowerCase()==&#x27;month&#x27; 
                                    || _selector.attr(&#x27;datatype&#x27;).toLowerCase()==&#x27;season&#x27; 
                                    || _selector.attr(&#x27;datatype&#x27;).toLowerCase()==&#x27;year&#x27; 
                                )) _r = 1;
                    if( _selector.prop(&#x27;nodeName&#x27;) 
                            &amp;&amp; _selector.attr(&#x27;multidate&#x27;)
                            &amp;&amp; _selector.prop(&#x27;nodeName&#x27;).toLowerCase()==&#x27;input&#x27;) _r = 1;
                }

                return _r;
            }
        /** 
         * 判断日历源控件是否为多选模式
         * @method  isMultiSelect
         * @static
         * return   bool
         */
        , isMultiSelect:
            function(){
                var _r = false;
                Calendar.lastIpt &amp;&amp; ( _r = parseBool( Calendar.lastIpt.attr(&#x27;multiselect&#x27;) ) );
                return _r;
            }
        /**
         * 请使用 isCalendar, 这个方法是为了向后兼容
         */
        , isCalendarElement: function( _selector ){ return Calendar.isCalendar( _selector ); }
        /**
         * 初始化外观后的回调函数
         * @property layoutInitedCallback
         * @type    function
         * @static
         * @default null
         */
        , layoutInitedCallback: null
        /**
         * 日历隐藏后的回调函数
         * @property layoutHideCallback
         * @type    function
         * @static
         * @default null
         */
        , layoutHideCallback: null
        /**
         * DOM 点击的过滤函数
         * &lt;br /&gt;默认 dom 点击时, 判断事件源不为 input[datatype=date|daterange] 会隐藏 Calendar
         * &lt;br /&gt; 通过该回调可自定义过滤, 返回 false 不执行隐藏操作
         * @property domClickFilter
         * @type    function
         * @static
         * @default null
         */
        , domClickFilter: null
        /**
         * 隐藏日历组件
         * @method  hide
         * @static
         * @example
                &lt;script&gt;JC.Calendar.hide();&lt;/script&gt;
         */
        , hide:
            function(){
                $(&#x27;body &gt; div.UXCCalendar&#x27;).hide();
                Calendar.layoutHideCallback &amp;&amp; Calendar.layoutHideCallback( Calendar.lastIpt );
                Calendar._triggerHide();
            }
        /**
         * 获取初始日期对象
         * @method  getDate
         * @static
         * @param   {selector}  _selector   显示日历组件的input
         * return   Object  { date: 0, minvalue: 0, maxvalue: 0, initMinvalue: 0, initMaxvalue: 0 }
         */
        , getDate:
            function( _selector ){
                var _r = { date: 0, minvalue: 0, maxvalue: 0, initMinvalue: 0, initMaxvalue: 0 }, _tmp;

                if( _tmp = parseISODate( _selector.val() ) ) _r.date = _tmp;
                else{
                    if( _selector.val() &amp;&amp; (_tmp = _selector.val().replace( /[^\d]/g, &#x27;&#x27; ) ).length == 16 ){
                        _r.date = parseISODate( _tmp.slice( 0, 8 ) );
                        _r.rangeStart = cloneDate( _r.date );
                        _r.rangeEnd = parseISODate( _tmp.slice( 8 ) );
                    }else{
                        _r.date = new Date();
                    }
                }

                _r.minvalue = parseISODate( _selector.attr(&#x27;minvalue&#x27;) );
                _r.maxvalue = parseISODate( _selector.attr(&#x27;maxvalue&#x27;) );
                
                //_r.minvalue &amp;&amp; ( _r.initMinvalue = cloneDate( _r.minvalue ) );
                //_r.maxvalue &amp;&amp; ( _r.initMaxvalue = cloneDate( _r.maxvalue ) );
                Calendar.updateInitYearList( _r );
                return _r;
            }
        , updateInitYearList:
            function( _dateObj ){
                _dateObj.initMinvalue = cloneDate( _dateObj.date );
                _dateObj.initMinvalue.setFullYear( _dateObj.initMinvalue.getFullYear() - Calendar.defaultDateSpan );

                _dateObj.initMaxvalue = cloneDate( _dateObj.date );
                _dateObj.initMaxvalue.setFullYear( _dateObj.initMaxvalue.getFullYear() + Calendar.defaultDateSpan );
            }
        /**
         * 每周的中文对应数字
         * @property    cnWeek
         * @type    string
         * @static
         * @default 日一二三四五六 
         */
        , cnWeek: &quot;日一二三四五六&quot;
        /**
         * 100以内的中文对应数字
         * @property    cnUnit
         * @type    string
         * @static
         * @default 十一二三四五六七八九    
         */
        , cnUnit: &quot;十一二三四五六七八九&quot;
        /**
         * 转换 100 以内的数字为中文数字
         * @method  getCnNum
         * @static
         * @param   {int}   _num
         * @return  string
         */
        , getCnNum:
            function ( _num ){
                var _r = Calendar.cnUnit.charAt( _num % 10 );
                _num &gt; 10 &amp;&amp; ( _r = (_num % 10 !== 0 ? Calendar.cnUnit.charAt(0) : &#x27;&#x27;) + _r );
                _num &gt; 19 &amp;&amp; ( _r = Calendar.cnUnit.charAt( Math.floor( _num / 10 ) ) + _r );
                return _r;
            }
        , _triggerShow:
            function(){
                var _ipt = Calendar.lastIpt, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarshow&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarshow&#x27;) ] )
                    &amp;&amp; _tmp.call( _ipt );
            }
        , _triggerHide:
            function(){
                var _ipt = Calendar.lastIpt, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarhide&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarhide&#x27;) ] )
                    &amp;&amp; _tmp.call( _ipt );
            }
        , _triggerLayoutChange:
            function(){
                var _ipt = Calendar.lastIpt, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarlayoutchange&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarlayoutchange&#x27;) ] )
                    &amp;&amp; _tmp.call( _ipt );
            }
        , _triggerClear:
            function(){
                var _ipt = Calendar.lastIpt, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarclear&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarclear&#x27;) ] )
                    &amp;&amp; _tmp.call( _ipt );
            }
        , _triggerUpdate:
            function( _data ){
                var _ipt = Calendar.lastIpt, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarupdate&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarupdate&#x27;) ] )
                    &amp;&amp; _tmp.apply( _ipt, _data );
            }
        , _triggerUpdateMultiSelect:
            function( _data ){
                var _ipt = Calendar.lastIpt, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarupdatemultiselect&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarupdatemultiselect&#x27;) ] )
                    &amp;&amp; _tmp.apply( _ipt, _data );
            }
        /**
         * 自定义日历组件模板
         * &lt;p&gt;默认模板为_logic.tpl&lt;/p&gt;
         * &lt;p&gt;如果用户显示定义JC.Calendar.tpl的话, 将采用用户的模板&lt;/p&gt;
         * @property    tpl
         * @type    {string}
         * @default empty
         * @static
         */
        , tpl: &#x27;&#x27;
    };
    /**
     * 私有逻辑处理对象, 基本上所有逻辑方法都存放于此对象
     * @property _logic
     * @type {Object}
     * @static
     * @private
     */
    var _logic =
    {
        /**
         * 初始化日历组件的触发按钮
         * @method  _logic.initTrigger
         * @param   {selector}      _selector   
         * @private
         */
        initTrigger:
            function( _selector ){
               _selector.each( function(){
                    var _p = $(this), _nodeName = (_p.prop(&#x27;nodeName&#x27;)||&#x27;&#x27;).toLowerCase();
                    //JC.log( &#x27;\nCalendar.init: &#x27;, _nodeName );

                    if( _nodeName != &#x27;input&#x27; ){ 
                        _logic.initTrigger( _selector.find( $(&#x27;input[type=text]&#x27;) ) ); 
                        return; 
                    }
                    if( !($.trim( _p.attr(&#x27;datatype&#x27;) || &#x27;&#x27;).toLowerCase() == &#x27;date&#x27; 
                            || $.trim( _p.attr(&#x27;multidate&#x27;) || &#x27;&#x27;)
                            || $.trim( _p.attr(&#x27;datatype&#x27;) || &#x27;&#x27;).toLowerCase() == &#x27;daterange&#x27;) ) return;

                    //JC.log( &#x27;find Calendar item:&#x27;, _p.attr(&#x27;name&#x27;), _p.attr(&#x27;id&#x27;), _p.attr(&#x27;datatype&#x27;) );
                    var _btn = _p.find( &#x27;+ input.UXCCalendar_btn&#x27; );
                    if( !_btn.length ){
                        _p.after( _btn = $(&#x27;&lt;input type=&quot;button&quot; class=&quot;UXCCalendar_btn&quot;  /&gt;&#x27;) );
                    }

                    _btn[0].forCalendar = _p;
                });
            }
        /**
         * 最后一个显示日历组件的日期对象
         * @property    _logic.lastDateObj
         * @type        Object
         * @private
         */
        , lastDateObj: null
        /**
         * 显示日历组件
         * @method  _logic.pickDate
         * @param   {selector}  _selector input[type=text][datatype=date]
         * @private
         */
        , pickDate:
            function( _selector ){
                JC.log( &#x27;Calendar.pickDate&#x27;, new Date().getTime() );

                _selector = $(_selector);

                var _dateObj = _logic.lastDateObj = Calendar.getDate( _selector );

                JC.log( _dateObj.date.getFullYear(), _dateObj.date.getMonth()+1, _dateObj.date.getDate() );

                _logic.initDateLayout( _dateObj );
                Calendar.setPosition( _selector, _logic.getLayout() );

                _selector.blur();
            }
        /**
         * 初始化日历组件的所有日期
         *      _dateObj = { date: date, minvalue: date, maxvalue: date, initMinvalue: date, initMaxvalue: date };
         * @method  _logic.initDateLayout
         * @param   {DateObjects}   _dateObj   保存所有相关日期的对象
         * @private
         */
        , initDateLayout:
            function( _dateObj ){
                Calendar.updateInitYearList( _dateObj );

                _logic.initYear( _dateObj );
                _logic.initMonth( _dateObj );
                _logic.initMonthDate( _dateObj );
            }
        /**
         * 初始化月份的所有日期
         * @method  _logic.initMonthDate
         * @param   {DateObjects}   _dateObj   保存所有相关日期的对象
         * @private
         */
        , initMonthDate:
            function( _dateObj ){
                var _layout = _logic.getLayout();
                var _maxday = maxDayOfMonth( _dateObj.date ), _weekday = _dateObj.date.getDay() || 7
                    , _sumday = _weekday + _maxday, _row = 6, _ls = [], _premaxday, _prebegin
                    , _tmp, i, _class;

                var _beginDate = new Date( _dateObj.date.getFullYear(), _dateObj.date.getMonth(), 1 );
                var _beginWeekday = _beginDate.getDay() || 7;
                if( _beginWeekday &lt; 2 ){
                    _beginDate.setDate( -(_beginWeekday-1+6) );
                }else{
                    _beginDate.setDate( -(_beginWeekday-2) );
                }
                var today = new Date();

                var ipt = JC.Calendar.lastIpt, currentcanselect = true;
                if( ipt.is(&#x27;[currentcanselect]&#x27;) ) currentcanselect = parseBool( ipt.attr(&#x27;currentcanselect&#x27;) );

                if( _dateObj.maxvalue &amp;&amp; !currentcanselect ){
                    _dateObj.maxvalue.setDate( _dateObj.maxvalue.getDate() - 1 );
                }

                _ls.push(&#x27;&lt;tr&gt;&#x27;);
                for( i = 1; i &lt;= 42; i++ ){
                    _class = [];
                    if( _beginDate.getDay() === 0 || _beginDate.getDay() == 6 ) _class.push(&#x27;weekend&#x27;);
                    if( !isSameMonth( _dateObj.date, _beginDate ) ) _class.push( &#x27;other&#x27; );
                    if( _dateObj.minvalue &amp;&amp; _beginDate.getTime() &lt; _dateObj.minvalue.getTime() ) 
                        _class.push( &#x27;unable&#x27; );
                    if( _dateObj.maxvalue &amp;&amp; _beginDate.getTime() &gt; _dateObj.maxvalue.getTime() ) 
                        _class.push( &#x27;unable&#x27; );

                    if( isSameDay( _beginDate, today ) ) _class.push( &#x27;today&#x27; );
                    if( isSameDay( _dateObj.date, _beginDate ) ) _class.push( &#x27;cur&#x27; );

                    _ls.push( &#x27;&lt;td class=&quot;&#x27;, _class.join(&#x27; &#x27;),&#x27;&quot;&gt;&#x27;
                            ,&#x27;&lt;a href=&quot;javascript:&quot; date=&quot;&#x27;, _beginDate.getTime(),&#x27;&quot; title=&quot;&#x27;+formatISODate(_beginDate)+&#x27;&quot; &gt;&#x27;
                            , _beginDate.getDate(), &#x27;&lt;/a&gt;&lt;/td&gt;&#x27; );
                    _beginDate.setDate( _beginDate.getDate() + 1 );
                    if( i % 7 === 0 &amp;&amp; i != 42 ) _ls.push( &#x27;&lt;/tr&gt;&lt;tr&gt;&#x27; );
                }
                _ls.push(&#x27;&lt;/tr&gt;&#x27;);

                _layout.find(&#x27;table.UTableBorder tbody&#x27; ).html( $( _ls.join(&#x27;&#x27;) ) );

                JC.log( _prebegin, _premaxday, _maxday, _weekday, _sumday, _row );
            }
        /**
         * 初始化月份
         * @method  _logic.initMonth
         * @param   {DateObjects}   _dateObj   保存所有相关日期的对象
         * @private
         */
        , initMonth:
            function( _dateObj ){
                var _layout = _logic.getLayout();
                $( _layout.find(&#x27;select.UMonth&#x27;).val( _dateObj.date.getMonth() ) );
            }
        /**
         * 初始化年份
         * @method  _logic.initYear
         * @param   {DateObjects}   _dateObj   保存所有相关日期的对象
         * @private
         */
        , initYear:
            function( _dateObj ){
                var _layout = _logic.getLayout(), _ls = [], _tmp, _selected
                    , _sYear = _dateObj.initMinvalue.getFullYear()
                    , _eYear = _dateObj.initMaxvalue.getFullYear();

                JC.log( _sYear, _eYear );

                if( !_selected ) _selected = _dateObj.date.getFullYear();

                for( var i = _sYear; i &lt;= _eYear; i++ ){
                    _tmp = &#x27;&#x27;;
                    if( _selected === i ) _tmp = &quot; selected &quot;
                    _ls.push( &#x27;&lt;option value=&quot;&#x27;+i+&#x27;&quot;&#x27;+_tmp+&#x27;&gt;&#x27;+i+&#x27;&lt;/option&gt;&#x27; );
                }

                $( _ls.join(&#x27;&#x27;) ).appendTo( _layout.find(&#x27;select.UYear&#x27;).html(&#x27;&#x27;) );
            }
        /**
         * 按年份更改日期
         * @method  _logic.updateYear
         * @param   {int}   _year   新的年份, YYYY
         * @private
         */
        , updateYear:
            function( _year ){
                JC.log( _year );
                if ( !_logic.lastDateObj ) return;
                var _premaxday = maxDayOfMonth( _logic.lastDateObj.date )
                    , _d = new Date( _year, _logic.lastDateObj.date.getMonth(), 1 )
                    , _nextmaxday = maxDayOfMonth( _d );
                if( _premaxday &gt; _nextmaxday ) _d.setDate( _nextmaxday );
                else _d.setDate( _logic.lastDateObj.date.getDate() );

                _logic.lastDateObj.date = _d;

                _logic.initDateLayout( _logic.lastDateObj );
            }
        /**
         * 按月份更改日期
         * @method  _logic.setNewMonth
         * @param   {int}   _month  新的月份, mm
         * @private
         */
        , setNewMonth:
            function( _month ){
                JC.log( _month );
                if ( !_logic.lastDateObj ) return;
                var _premaxday = maxDayOfMonth( _logic.lastDateObj.date )
                    , _d = new Date( _logic.lastDateObj.date.getFullYear(), _month, 1 )
                    , _nextmaxday = maxDayOfMonth( _d );
                if( _premaxday &gt; _nextmaxday ) _d.setDate( _nextmaxday );
                else _d.setDate( _logic.lastDateObj.date.getDate() );

                _logic.lastDateObj.date = _d;

                _logic.initMonth( _logic.lastDateObj );
                _logic.initMonthDate( _logic.lastDateObj );
            }
        /**
         * 获取日历组件的外观
         * @method  _logic.getLayout
         * @return  {selector} 日历组件的selector
         * @private
         */
        , getLayout:
            function(){
                var _r = $(&#x27;#UXCCalendar&#x27;);

                if( !_r.length ){
                    _r = $( Calendar.tpl || _logic.tpl );
                    _r.attr(&#x27;id&#x27;, &#x27;UXCCalendar&#x27;).hide().appendTo( document.body );
                    var _month = $( [
                                &#x27;&lt;option value=&quot;0&quot;&gt;一月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;1&quot;&gt;二月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;2&quot;&gt;三月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;3&quot;&gt;四月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;4&quot;&gt;五月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;5&quot;&gt;六月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;6&quot;&gt;七月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;7&quot;&gt;八月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;8&quot;&gt;九月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;9&quot;&gt;十月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;10&quot;&gt;十一月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;11&quot;&gt;十二月&lt;/option&gt;&#x27;
                            ].join(&#x27;&#x27;) ).appendTo( _r.find(&#x27;select.UMonth&#x27; ) );
                    _r.hide();
                    _r.data(&#x27;confirmMethod&#x27;, _logic.onConfirm );
                    _r.data(&#x27;updateYearMethod&#x27;, _logic.updateYear );
                 }

                return _r;
            }
        /**
         * 把日期赋值给文本框
         * @method  _logic.setDate
         * @param   {int}   _timestamp  日期对象的时间戳
         * @private
         */
        , setDate:
            function( _timestamp ){
                if( !(_timestamp &amp;&amp; Calendar.lastIpt &amp;&amp; Calendar.lastIpt.length ) ) return;
                var _d = new Date(), _symbol = &#x27;-&#x27;; _d.setTime( _timestamp );
                var _df = Calendar.lastIpt.attr(&#x27;dateFormat&#x27;);
                if( _df ){
                    _df = _df.replace(/[\da-zA-Z]/g, &#x27;&#x27;);
                    if( _df.length ) _df = _df.slice(0, 1);
                    _symbol = _df;
                }
                var _dStr = formatISODate( _d, _symbol );
                Calendar.lastIpt.val( _dStr ).focus();
            }
        /**
         * 给文本框赋值, 日期为控件的当前日期
         * @method  _logic.onConfirm
         * @return  {int}   0/1
         * @private
         */
        , onConfirm:
            function(){
                var _cur = _logic.getLayout().find(&#x27;td.cur&#x27;);
                if( !_cur.length ) _logic.getLayout().find(&#x27;td.today&#x27;);
                if( _cur.length &amp;&amp; _cur.hasClass(&#x27;unable&#x27;) ) return 0;
                if( _cur.length ) _cur.find(&#x27;a&#x27;).trigger(&#x27;click&#x27;);

                return 1;
            }
        /**
         * 日历组件模板
         * &lt;p&gt;这是默认模板, 用户可以给 JC.Calendar.tpl 赋值, 更改为自己的模板&lt;/p&gt;
         * @property    _logic.tpl
         * @type    string
         * @private
         */
        , tpl: 
        [
        &#x27;&lt;div id=&quot;UXCCalendar&quot; class=&quot;UXCCalendar&quot;&gt;\n&#x27;
        ,&#x27;    &lt;div class=&quot;UHeader&quot;&gt;\n&#x27;
        ,&#x27;        &lt;select class=&quot;UYear&quot;&gt;&lt;/select&gt;\n&#x27;
        ,&#x27;        &lt;img class=&quot;UImg yearctl&quot; align=&quot;absMiddle&quot; usemap=&quot;#UXCCalendar_Year&quot; /&gt;\n&#x27;
        ,&#x27;        &lt;map name=&quot;UXCCalendar_Year&quot;&gt;&lt;area shape=&quot;rect&quot; coords=&quot;0,0,13,8&quot; href=&quot;#&quot; action=&quot;up&quot;&gt;&lt;area shape=&quot;rect&quot; coords=&quot;0,10,13,17&quot; href=&quot;#&quot; action=&quot;down&quot;&gt;&lt;/map&gt;\n&#x27;
        ,&#x27;        &lt;select class=&quot;UMonth&quot;&gt;&lt;/select&gt;\n&#x27;
        ,&#x27;        &lt;img class=&quot;UImg monthctl&quot; align=&quot;absMiddle&quot; usemap=&quot;#UXCCalendar_Month&quot;  /&gt;\n&#x27;
        ,&#x27;        &lt;map name=&quot;UXCCalendar_Month&quot;&gt;&lt;area shape=&quot;rect&quot; coords=&quot;0,0,13,8&quot; href=&quot;#&quot; action=&quot;up&quot;&gt;&lt;area shape=&quot;rect&quot; coords=&quot;0,10,13,17&quot; href=&quot;#&quot; action=&quot;down&quot;&gt;&lt;/map&gt;\n&#x27;
        ,&#x27;    &lt;/div&gt;\n&#x27;
        ,&#x27;    &lt;table class=&quot;UTable&quot;&gt;\n&#x27;
        ,&#x27;        &lt;thead&gt;\n&#x27;
        ,&#x27;            &lt;tr&gt;\n&#x27;
        ,&#x27;                &lt;th&gt;一&lt;/th&gt;\n&#x27;
        ,&#x27;                &lt;th&gt;二&lt;/th&gt;\n&#x27;
        ,&#x27;                &lt;th&gt;三&lt;/th&gt;\n&#x27;
        ,&#x27;                &lt;th&gt;四&lt;/th&gt;\n&#x27;
        ,&#x27;                &lt;th&gt;五&lt;/th&gt;\n&#x27;
        ,&#x27;                &lt;th&gt;六&lt;/th&gt;\n&#x27;
        ,&#x27;                &lt;th&gt;日&lt;/th&gt;\n&#x27;
        ,&#x27;            &lt;/tr&gt;\n&#x27;
        ,&#x27;        &lt;/thead&gt;\n&#x27;
        ,&#x27;   &lt;/table&gt;\n&#x27;
        ,&#x27;   &lt;table class=&quot;UTable UTableBorder&quot;&gt;\n&#x27;
        ,&#x27;        &lt;tbody&gt;\n&#x27;
        ,&#x27;           &lt;!--&lt;tr&gt;\n&#x27;
        ,&#x27;                &lt;td class=&quot;cur&quot;&gt;&lt;a href=&quot;#&quot;&gt;2&lt;/a&gt;&lt;/td&gt;\n&#x27;
        ,&#x27;                &lt;td class=&quot;unable&quot;&gt;&lt;a href=&quot;#&quot;&gt;2&lt;/a&gt;&lt;/td&gt;\n&#x27;
        ,&#x27;                &lt;td class=&quot;weekend cur&quot;&gt;&lt;a href=&quot;#&quot;&gt;6&lt;/a&gt;&lt;/td&gt;\n&#x27;
        ,&#x27;                &lt;td class=&quot;weekend hover&quot;&gt;&lt;a href=&quot;#&quot;&gt;13&lt;/a&gt;&lt;/td&gt;\n&#x27;
        ,&#x27;                &lt;td class=&quot;weekend other&quot;&gt;&lt;a href=&quot;#&quot;&gt;41&lt;/a&gt;&lt;/td&gt;\n&#x27;
        ,&#x27;                &lt;td class=&quot;weekend other&quot;&gt;&lt;a href=&quot;#&quot;&gt;42&lt;/a&gt;&lt;/td&gt;\n&#x27;
        ,&#x27;            &lt;/tr&gt;\n--&gt;&#x27;
        ,&#x27;        &lt;/tbody&gt;\n&#x27;
        ,&#x27;    &lt;/table&gt;\n&#x27;
        ,&#x27;    &lt;div class=&quot;UFooter&quot;&gt;\n&#x27;
        ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UConfirm&quot;&gt;确定&lt;/button&gt;\n&#x27;
        ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UClear&quot;&gt;清空&lt;/button&gt;\n&#x27;
        ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UCancel&quot;&gt;取消&lt;/button&gt;\n&#x27;
        ,&#x27;    &lt;/div&gt;\n&#x27;
        ,&#x27;&lt;/div&gt;\n&#x27;
        ].join(&#x27;&#x27;)
    };
    /**
     * DOM 加载完毕后, 初始化日历组件相关事件
     * @event   dom ready
     * @private
     */
    $(document).ready( function($evt){
        /**
         * 延迟200毫秒初始化页面的所有日历控件
         * 之所以要延迟是可以让用户自己设置是否需要自动初始化
         */
        setTimeout( function( $evt ){
            if( !Calendar.autoInit ) return;
            Calendar.init( $(&#x27;input[type=text]&#x27;) );
        }, 200 );
        /**
         * 捕获用户更改年份 
         * &lt;p&gt;监听 年份下拉框&lt;/p&gt;
         * @event year change
         * @private
         */
        $(document).delegate( &#x27;body &gt; div.UXCCalendar select.UYear&#x27;, &#x27;change&#x27;, function( $evt ){
            var box = $(this).parents( &#x27;div.UXCCalendar&#x27; );
            box.length &amp;&amp; box.data(&#x27;updateYearMethod&#x27;) &amp;&amp; box.data(&#x27;updateYearMethod&#x27;)( $(this).val()  );
            Calendar._triggerLayoutChange();
        });
        /**
         * 捕获用户更改年份 
         * &lt;p&gt;监听 下一年按钮&lt;/p&gt;
         * @event next year
         * @private
         */
        $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UNextYear&#x27;, &#x27;click&#x27;, function( $evt ){
            var box = $(this).parents( &#x27;div.UXCCalendar&#x27; );
            box.length &amp;&amp; box.data(&#x27;nextYearMethod&#x27;) &amp;&amp; box.data(&#x27;nextYearMethod&#x27;)();
            Calendar._triggerLayoutChange();
        });
        /**
         * 捕获用户更改年份 
         * &lt;p&gt;监听 上一年按钮&lt;/p&gt;
         * @event previous year
         * @private
         */
        $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UPreYear&#x27;, &#x27;click&#x27;, function( $evt ){
            var box = $(this).parents( &#x27;div.UXCCalendar&#x27; );
            box.length &amp;&amp; box.data(&#x27;preYearMethod&#x27;) &amp;&amp; box.data(&#x27;preYearMethod&#x27;)();
            Calendar._triggerLayoutChange();
        });
        /**
         * 捕获用户更改月份
         * &lt;p&gt;监听 月份下拉框&lt;/p&gt;
         * @event   month change
         * @private
         */
        $(document).delegate( &#x27;#UXCCalendar select.UMonth&#x27;, &#x27;change&#x27;, function( $evt ){
            _logic.setNewMonth( $(this).val() );
            Calendar._triggerLayoutChange();
        });
        /**
         * 选择当前日期
         * &lt;p&gt;监听确定按钮&lt;/p&gt;
         * @event   confirm click
         * @private
         */
        $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UConfirm&#x27;, &#x27;click&#x27;, function( $evt ){
            var box = $(this).parents( &#x27;div.UXCCalendar&#x27; ), _tmp;
            if( box.length &amp;&amp; ( _tmp = box.find(&#x27;td.cur&#x27;) ).length ){
                if( _tmp.hasClass( &#x27;unable&#x27; ) ) return;
            }
            box.length &amp;&amp; box.data(&#x27;confirmMethod&#x27;) &amp;&amp; box.data(&#x27;confirmMethod&#x27;)( this );
            Calendar.hide();
        });
        /**
         * 增加或者减少一年
         * &lt;p&gt;监听 年份map&lt;/p&gt;
         * @event   year map click
         * @private
         */
        $(document).delegate( &quot;map[name=UXCCalendar_Year] area&quot; , &#x27;click&#x27;, function( $evt ){
            $evt.preventDefault();
            var _p = $(this), _do = _logic.lastDateObj;
            if( !(_do &amp;&amp; _p.attr(&quot;action&quot;) ) ) return;
            if( _p.attr(&quot;action&quot;).toLowerCase() == &#x27;up&#x27; ){
                _do.date.setFullYear( _do.date.getFullYear() + 1 );
            }else if( _p.attr(&quot;action&quot;).toLowerCase() == &#x27;down&#x27; ){
                _do.date.setFullYear( _do.date.getFullYear() - 1 );
            }
            _logic.initDateLayout( _do );
            JC.log( _p.attr(&quot;action&quot;) );
            Calendar._triggerLayoutChange();
        });
        /**
         * 增加或者减少一个月
         * &lt;p&gt;监听 月份map&lt;/p&gt;
         * @event   month map click
         * @private
         */
        $(document).delegate( &quot;map[name=UXCCalendar_Month] area&quot; , &#x27;click&#x27;, function( $evt ){
            $evt.preventDefault();
            var _p = $(this), _do = _logic.lastDateObj;
            if( !(_do &amp;&amp; _p.attr(&quot;action&quot;) ) ) return;
            if( _p.attr(&quot;action&quot;).toLowerCase() == &#x27;up&#x27; ){
                _do.date.setMonth( _do.date.getMonth() + 1 );
                _do.initMinvalue.setMonth( _do.initMinvalue.getMonth() + 1 );
                _do.initMaxvalue.setMonth( _do.initMaxvalue.getMonth() + 1 );
            }else if( _p.attr(&quot;action&quot;).toLowerCase() == &#x27;down&#x27; ){
                _do.date.setMonth( _do.date.getMonth() - 1 );
                _do.initMinvalue.setMonth( _do.initMinvalue.getMonth() - 1 );
                _do.initMaxvalue.setMonth( _do.initMaxvalue.getMonth() - 1 );
            }
            _logic.initDateLayout( _do );
            JC.log( _p.attr(&quot;action&quot;) );
            Calendar._triggerLayoutChange();
        });
        /**
         * 清除文本框内容
         * &lt;p&gt;监听 清空按钮&lt;/p&gt;
         * @event   clear click
         * @private
         */
        $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UClear&#x27;, &#x27;click&#x27;, function( $evt ){
            Calendar.lastIpt 
                &amp;&amp; Calendar.lastIpt.length 
                &amp;&amp; ( Calendar.lastIpt.val(&#x27;&#x27;), Calendar._triggerClear() )
                ;
        });
        /**
         * 取消日历组件, 相当于隐藏
         * &lt;p&gt;监听 取消按钮&lt;/p&gt;
         * @event cancel click
         * @private
         */
        $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UCancel&#x27;, &#x27;click&#x27;, function( $evt ){
            Calendar.hide();
        });
        /**
         * dom 点击时, 检查事件源是否为日历组件对象, 如果不是则会隐藏日历组件
         * @event dom click
         * @private
         */
        $(document).on(&#x27;click&#x27;, function($evt){
            var _src = $evt.target || $evt.srcElement;

            if( Calendar.domClickFilter ) if( Calendar.domClickFilter( $(_src) ) === false ) return;

            if( Calendar.isCalendarElement($evt.target||$evt.targetElement) ) return;

            if( _src &amp;&amp; ( _src.nodeName.toLowerCase() != &#x27;input&#x27; &amp;&amp; _src.nodeName.toLowerCase() != &#x27;button&#x27; ) ){
                Calendar.hide(); return;
            }

            setTimeout( function(){
                if( Calendar.lastIpt &amp;&amp; Calendar.lastIpt.length &amp;&amp; _src == Calendar.lastIpt[0] ) return;
                Calendar.hide();
            }, 100);
        });
        /**
         * 日历组件按钮点击事件
         * @event calendar button click
         * @private
         */
        $(document).delegate( &#x27;input.UXCCalendar_btn&#x27;, &#x27;click&#x27;, function($evt){
            if( this.forCalendar ) Calendar.pickDate( this.forCalendar );
        });
        /**
         * 日历组件文本框获得焦点
         * @event input focus
         * @private
         */
        $(document).delegate( [ &#x27;input[datatype=season]&#x27;, &#x27;input[datatype=month]&#x27;, &#x27;input[datatype=week]&#x27;
                , &#x27;input[datatype=date]&#x27;, &#x27;input[datatype=daterange]&#x27;, &#x27;input[multidate]&#x27; ].join(), &#x27;focus&#x27; , function($evt){
                Calendar.pickDate( this );
        });
        $(document).delegate( [ &#x27;button[datatype=season]&#x27;, &#x27;button[datatype=month]&#x27;, &#x27;button[datatype=week]&#x27;
                , &#x27;button[datatype=date]&#x27;, &#x27;button[datatype=daterange]&#x27;, &#x27;button[multidate]&#x27; ].join(), &#x27;click&#x27; , function($evt){
                Calendar.pickDate( this );
        });
        /**
         * 日历组件点击事件, 阻止冒泡, 防止被 document click事件隐藏
         * @event UXCCalendar click
         * @private
         */
        $(document).delegate( &#x27;body &gt; div.UXCCalendar&#x27;, &#x27;click&#x27;, function( $evt ){
            $evt.stopPropagation();
        });
        /**
         * 日期点击事件
         * @event date click
         * @private
         */
        $(document).delegate( &#x27;#UXCCalendar table a&#x27;, &#x27;click&#x27;, function( $evt ){
            $evt.preventDefault();
            var _p = $(this), _tm = _p.attr(&#x27;date&#x27;)||&#x27;&#x27;, _d = new Date(), _isMultiselect = Calendar.isMultiSelect();
            if( !_tm ) return;
            if( _p.parent(&#x27;td&#x27;).hasClass(&#x27;unable&#x27;) ) return;

            JC.log( _tm );

            _logic.setDate( _tm );
            Calendar.hide();

            _d.setTime( _tm );
            Calendar._triggerUpdate( [ &#x27;date&#x27;, _d, _d ] );
        });
        /**
         * 监听窗口滚动和改变大小, 实时变更日历组件显示位置
         * @event  window scroll, window resize
         * @private
         */
        $(window).on(&#x27;scroll resize&#x27;, function($evt){
            var _layout = $(&#x27;body &gt; div.UXCCalendar:visible&#x27;);
            if( !( _layout.length &amp;&amp; Calendar.lastIpt ) ) return;
            Calendar.setPosition( Calendar.lastIpt, _layout );
        });
    });
}(jQuery));


(function($){
    /**
     * 弹出一年中所有周的选择框
     * @method  pickWeek
     * @for     JC.Calendar
     * @static
     * @param   {selector}  _selector
     */
    JC.Calendar.pickWeek =
        function( _selector ){
            _logic.lastDateObj = JC.Calendar.getDate( _selector );
            JC.Calendar.lastIpt = _selector;
            JC.Calendar.setPosition( _selector, _logic.update( _logic.lastDateObj ) );
        };
    /**
     * 自定义周弹框的模板HTML
     * @for         JC.Calendar
     * @property    pickWeek.tpl
     * @type        string
     * @default     empty
     * @static
     */
    JC.Calendar.pickWeek.tpl = &#x27;&#x27;;
    /**
     * 自定义周日历每周的起始日期 
     * &lt;br /&gt; 0 - 6, 0=周日, 1=周一
     * @for         JC.Calendar
     * @property    pickWeek.dayOffset
     * @static
     * @type    int
     * @default 1
     */
    JC.Calendar.pickWeek.dayOffset = 1;

    var _logic = {
        getLayout:
            function(){
                var _box
                if( !( _box = $(&#x27;#UXCCalendar_week&#x27;) ).length ){
                    _box = $( JC.Calendar.pickWeek.tpl || _logic.tpl ); 
                    _box.appendTo( document.body );
                    _box.data(&#x27;confirmMethod&#x27;, _logic.onConfirm );
                    _box.data(&#x27;updateYearMethod&#x27;, _logic.updateYear );
                    _box.data(&#x27;nextYearMethod&#x27;, _logic.nextYear );
                    _box.data(&#x27;preYearMethod&#x27;, _logic.preYear );
                }
                return _box;
            }

        , onConfirm:
            function(){
                JC.log( &#x27;Calendar.pickWeek, onConfirm&#x27; );
                var _cur = _logic.getLayout().find(&#x27;td.cur&#x27;);
                if( !_cur.length ) _logic.getLayout().find(&#x27;td.today&#x27;);
                if( _cur.length &amp;&amp; _cur.hasClass(&#x27;unable&#x27;) ) return 0;
                if( _cur.length ) _cur.find(&#x27;a&#x27;).trigger(&#x27;click&#x27;);
            }
        , updateYear:
            function( _val ){
                if( !_logic.lastDateObj ) return;
                _logic.lastDateObj.date.setFullYear( _val );
                JC.Calendar.updateInitYearList( _logic.lastDateObj );
                _logic.update( _logic.lastDateObj );
            }
        , nextYear:
            function(){
                JC.log( &#x27;nextYearMethod&#x27; );
                if( !_logic.lastDateObj ) return;
                _logic.updateYear( _logic.lastDateObj.date.getFullYear() + 1)
            }
        , preYear:
            function(){
                JC.log( &#x27;preYearMethod&#x27; );
                if( !_logic.lastDateObj ) return;
                _logic.updateYear( _logic.lastDateObj.date.getFullYear() - 1)
            }
        , update:
            function( _dateObj ){
                _logic.getLayout();
                _logic.updateHead( _dateObj );
                _logic.updateBody( _dateObj );
                return _logic.getLayout();
            }
        , updateHead:
            function( _dateObj ){
                var _layout = _logic.getLayout(), _ls = [], _tmp, _selected
                    , _sYear = _dateObj.initMinvalue.getFullYear()
                    , _eYear = _dateObj.initMaxvalue.getFullYear();


                if( !_selected ) _selected = _dateObj.date.getFullYear();

                for( var i = _sYear; i &lt;= _eYear; i++ ){
                    _tmp = &#x27;&#x27;;
                    if( _selected === i ) _tmp = &quot; selected &quot;
                    _ls.push( &#x27;&lt;option value=&quot;&#x27;+i+&#x27;&quot;&#x27;+_tmp+&#x27;&gt;&#x27;+i+&#x27;&lt;/option&gt;&#x27; );
                }

                $( _ls.join(&#x27;&#x27;) ).appendTo( _layout.find(&#x27;select.UYear&#x27;).html(&#x27;&#x27;) );

            }
        , updateBody:
            function( _dateObj ){
                var _date = _dateObj.date;
                var _layout = _logic.getLayout();
                    _layout.find(&#x27;button.UYearButton&#x27;).html( _date.getFullYear() );

                var today = new Date( new Date().getFullYear(), new Date().getMonth(), new Date().getDate() ).getTime();
                var weeks = weekOfYear( _date.getFullYear(), JC.Calendar.pickWeek.dayOffset );
                var nextYearWeeks = weekOfYear( _date.getFullYear() + 1, JC.Calendar.pickWeek.dayOffset );
                var nextCount = 0;
                var _ls = [], _class, _data, _title, _sdate, _edate, _year = _date.getFullYear()
                    , _rows = Math.ceil( weeks.length / 8 );

                var ipt = JC.Calendar.lastIpt, currentcanselect = parseBool( ipt.attr(&#x27;currentcanselect&#x27;) );

                if( _dateObj.maxvalue &amp;&amp; currentcanselect ){
                    var _wd = _dateObj.maxvalue.getDay();
                    if( _wd &gt; 0 ) {
                        _dateObj.maxvalue.setDate( _dateObj.maxvalue.getDate() + ( 7 - _wd ) );
                    }
                }

                _ls.push(&#x27;&lt;tr&gt;&#x27;);
                for( i = 1, j = _rows * 8; i &lt;= j; i++ ){
                    _data = weeks[ i - 1];
                    if( !_data ) {
                        _data = nextYearWeeks[ nextCount++ ];
                        _year = _date.getFullYear() + 1;
                    }
                    _sdate = new Date(); _edate = new Date();
                    _sdate.setTime( _data.start ); _edate.setTime( _data.end );

                    _title = printf( &quot;{0}年 第{1}周&lt;br/&gt;开始日期: {2} (周{4})&lt;br /&gt;结束日期: {3} (周{5})&quot;
                                , _year
                                , JC.Calendar.getCnNum( _data.week )
                                , formatISODate( _sdate )
                                , formatISODate( _edate )
                                , JC.Calendar.cnWeek.charAt( _sdate.getDay() % 7 )
                                , JC.Calendar.cnWeek.charAt( _edate.getDay() % 7 )
                                );

                    _class = [];

                    if( _dateObj.minvalue &amp;&amp; _sdate.getTime() &lt; _dateObj.minvalue.getTime() ) 
                        _class.push( &#x27;unable&#x27; );
                    if( _dateObj.maxvalue &amp;&amp; _edate.getTime() &gt; _dateObj.maxvalue.getTime() ){
                        _class.push( &#x27;unable&#x27; );
                    }

                    if( _date.getTime() &gt;= _sdate.getTime() &amp;&amp; _date.getTime() &lt;= _edate.getTime() ) _class.push( &#x27;cur&#x27; );
                    if( today &gt;= _sdate.getTime() &amp;&amp; today &lt;= _edate.getTime() ) _class.push( &#x27;today&#x27; );

                    _ls.push( printf( &#x27;&lt;td class=&quot;{0}&quot;&gt;&lt;a href=&quot;javascript:&quot; title=&quot;{2}&quot;&#x27;+
                                    &#x27; dstart=&quot;{3}&quot; dend=&quot;{4}&quot; week=&quot;{1}&quot; &gt;{1}&lt;/a&gt;&lt;/td&gt;&#x27;
                                , _class.join(&#x27; &#x27;)
                                , _data.week 
                                , _title
                                , _sdate.getTime()
                                , _edate.getTime()
                            ));
                    if( i % 8 === 0 &amp;&amp; i != j ) _ls.push( &#x27;&lt;/tr&gt;&lt;tr&gt;&#x27; );
                }
                _ls.push(&#x27;&lt;/tr&gt;&#x27;); 
 
                _layout.find(&#x27;table.UTableBorder tbody&#x27; ).html( $( _ls.join(&#x27;&#x27;) ) );

            }
        /**
         * 最后一个显示日历组件的日期对象
         * @property    _logic.lastDateObj
         * @type        Object
         * @private
         */
        , lastDateObj: null
        , tpl:
            [
            &#x27;&lt;div id=&quot;UXCCalendar_week&quot; class=&quot;UXCCalendar UXCCalendar_week&quot; &gt;&#x27;
            ,&#x27;    &lt;div class=&quot;UHeader&quot;&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UButton UNextYear&quot;&gt;&amp;nbsp;&amp;gt;&amp;gt;&amp;nbsp;&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UButton UPreYear&quot;&gt;&amp;nbsp;&amp;lt;&amp;lt;&amp;nbsp;&lt;/button&gt;&#x27;
            ,&#x27;        &lt;select class=&quot;UYear&quot; style=&quot;&quot;&gt;&lt;/select&gt;&#x27;
            ,&#x27;    &lt;/div&gt;&#x27;
            ,&#x27;    &lt;table class=&quot;UTable UTableBorder&quot;&gt;&#x27;
            ,&#x27;        &lt;tbody&gt;&lt;/tbody&gt;&#x27;
            ,&#x27;    &lt;/table&gt;&#x27;
            ,&#x27;    &lt;div class=&quot;UFooter&quot;&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UConfirm&quot;&gt;确定&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UClear&quot;&gt;清空&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UCancel&quot;&gt;取消&lt;/button&gt;&#x27;
            ,&#x27;    &lt;/div&gt;&#x27;
            ,&#x27;&lt;/div&gt;&#x27;
            ].join(&#x27;&#x27;)
    };
    /**
     * 取一年中所有的星期, 及其开始结束日期
     * @method  weekOfYear
     * @static
     * @param   {int}   _year
     * @param   {int}   _dayOffset  每周的默认开始为周几, 默认0(周日)
     * @return  Array
     */
    function weekOfYear( _year, _dayOffset ){
        var _r = [], _tmp, _count = 1, _dayOffset = _dayOffset || 0
            , _year = parseInt( _year, 10 )
            , _d = new Date( _year, 0, 1 );
        /**
         * 元旦开始的第一个星期一开始的一周为政治经济上的第一周
         */
         _d.getDay() &gt; 1 &amp;&amp; _d.setDate( _d.getDate() - _d.getDay() + 7 );

         _dayOffset &gt; 0 &amp;&amp; ( _dayOffset = (new Date( 2000, 1, 2 ) - new Date( 2000, 1, 1 )) * _dayOffset );

        while( _d.getFullYear() &lt;= _year ){
            _tmp = { &#x27;week&#x27;: _count++, &#x27;start&#x27;: null, &#x27;end&#x27;: null };
            _tmp.start = _d.getTime() + _dayOffset;
            _d.setDate( _d.getDate() + 6 );
            _tmp.end = _d.getTime() + _dayOffset;
            _d.setDate( _d.getDate() + 1 );
            if( _d.getFullYear() &gt; _year ) {
                _d = new Date( _d.getFullYear(), 0, 1 );
                if( _d.getDay() &lt; 2 ) break;
             }
            _r.push( _tmp );
        }
        return _r;
    }

    $(document).delegate(&#x27;#UXCCalendar_week table a&#x27;, &#x27;click&#x27;, function( _evt ){
        var _p = $(this), dstart = new Date(), dend = new Date();
        if( !JC.Calendar.lastIpt ) return;
        if( _p.parent(&#x27;td&#x27;).hasClass( &#x27;unable&#x27; ) ) return;
        dstart.setTime( _p.attr(&#x27;dstart&#x27;) );
        dend.setTime( _p.attr(&#x27;dend&#x27;) );
        JC.Calendar.lastIpt.val( printf( &#x27;{0} 至 {1}&#x27;, formatISODate( dstart ), formatISODate( dend ) ) );
        JC.Calendar.hide();
        JC.Calendar._triggerUpdate( [ &#x27;season&#x27;, dstart, dend] );
    });


}(jQuery));

(function($){
    /**
     * 弹出一年中所有月份的选择框
     * @method  pickMonth
     * @for     JC.Calendar
     * @static
     * @param   {selector}  _selector
     */
    JC.Calendar.pickMonth =
        function( _selector ){
            _logic.lastDateObj = JC.Calendar.getDate( _selector );
            JC.Calendar.lastIpt = _selector;
            JC.Calendar.setPosition( _selector, _logic.update( _logic.lastDateObj ) );
        };
    /**
     * 自定义月份弹框的模板HTML
     * @for         JC.Calendar
     * @property    pickMonth.tpl
     * @type        string
     * @default     empty
     * @static
     */
    JC.Calendar.pickMonth.tpl = &#x27;&#x27;;

    var _logic = {
        getLayout:
            function(){
                var _box
                if( !( _box = $(&#x27;#UXCCalendar_month&#x27;) ).length ){
                    _box = $( JC.Calendar.pickMonth.tpl || _logic.tpl ); 
                    _box.appendTo( document.body );
                    _box.data(&#x27;confirmMethod&#x27;, _logic.onConfirm );
                    _box.data(&#x27;updateYearMethod&#x27;, _logic.updateYear );
                    _box.data(&#x27;nextYearMethod&#x27;, _logic.nextYear );
                    _box.data(&#x27;preYearMethod&#x27;, _logic.preYear );
                }
                return _box;
            }

        , onConfirm:
            function(){
                JC.log( &#x27;Calendar.pickMonth, onConfirm&#x27; );
                if( JC.Calendar.isMultiSelect() ){
                    JC.log( &#x27;pickMonth multiselect&#x27; );
                    _logic.updateMultiSelect();
                    return;
                }
                var _cur = _logic.getLayout().find(&#x27;td.cur&#x27;);
                if( !_cur.length ) _logic.getLayout().find(&#x27;td.today&#x27;);
                if( _cur.length &amp;&amp; _cur.hasClass(&#x27;unable&#x27;) ) return 0;
                if( _cur.length ) _cur.find(&#x27;a&#x27;).trigger(&#x27;click&#x27;);
            }

        , updateMultiSelect:
            function(){
                var _r = [], _text = [], _ls = _logic.getLayout().find(&#x27;td.cur&#x27;), _dstart, _dend, _td, _p;
                _ls.each( function(){
                    _td = $(this), _p = _td.find(&#x27;&gt; a&#x27;);
                    if( _p.is( &#x27;.unable&#x27; ) ) return;
                    _dstart = new Date();
                    _dend = new Date();
                    _dstart.setTime( _p.attr(&#x27;dstart&#x27;) );
                    _dend.setTime( _p.attr(&#x27;dend&#x27;) );

                    _r.push( {&#x27;begin&#x27;: _dstart, &#x27;end&#x27;: _dend } );
                    _text.push( printf( &#x27;{0} 至 {1}&#x27;, formatISODate( _dstart ), formatISODate( _dend ) ) );
                });
                JC.Calendar.lastIpt.val( _text.join(&#x27;, &#x27;) );
                JC.Calendar._triggerUpdateMultiSelect( [ &#x27;month&#x27;, _r ] );
                return _r;
            }

        , updateYear:
            function( _val ){
                if( !_logic.lastDateObj ) return;
                _logic.lastDateObj.date.setFullYear( _val );
                JC.Calendar.updateInitYearList( _logic.lastDateObj );
                _logic.update( _logic.lastDateObj );
            }
        , nextYear:
            function(){
                JC.log( &#x27;nextYearMethod&#x27; );
                if( !_logic.lastDateObj ) return;
                _logic.updateYear( _logic.lastDateObj.date.getFullYear() + 1)
            }
        , preYear:
            function(){
                JC.log( &#x27;preYearMethod&#x27; );
                if( !_logic.lastDateObj ) return;
                _logic.updateYear( _logic.lastDateObj.date.getFullYear() - 1)
            }
        , update:
            function( _dateObj ){
                _logic.getLayout();
                _logic.updateHead( _dateObj );
                _logic.updateBody( _dateObj );
                return _logic.getLayout();
            }
        , updateHead:
            function( _dateObj ){
                var _layout = _logic.getLayout(), _ls = [], _tmp, _selected
                    , _sYear = _dateObj.initMinvalue.getFullYear()
                    , _eYear = _dateObj.initMaxvalue.getFullYear();


                if( !_selected ) _selected = _dateObj.date.getFullYear();

                for( var i = _sYear; i &lt;= _eYear; i++ ){
                    _tmp = &#x27;&#x27;;
                    if( _selected === i ) _tmp = &quot; selected &quot;
                    _ls.push( &#x27;&lt;option value=&quot;&#x27;+i+&#x27;&quot;&#x27;+_tmp+&#x27;&gt;&#x27;+i+&#x27;&lt;/option&gt;&#x27; );
                }

                $( _ls.join(&#x27;&#x27;) ).appendTo( _layout.find(&#x27;select.UYear&#x27;).html(&#x27;&#x27;) );

            }
        , updateBody:
            function( _dateObj ){
                var _date = _dateObj.date;
                var _layout = _logic.getLayout();
                    _layout.find(&#x27;button.UYearButton&#x27;).html( _date.getFullYear() );

                var today = new Date( new Date().getFullYear(), new Date().getMonth(), new Date().getDate() ).getTime();
                var _ls = [], _class, _data, _title, _sdate, _edate, _cnUnit
                    , _year = _date.getFullYear();

                var ipt = JC.Calendar.lastIpt, currentcanselect = parseBool( ipt.attr(&#x27;currentcanselect&#x27;) );

                if( _dateObj.maxvalue &amp;&amp; currentcanselect ){
                    _dateObj.maxvalue.setDate( maxDayOfMonth( _dateObj.maxvalue ) );
                }

                _ls.push(&#x27;&lt;tr&gt;&#x27;);
                for( i = 1, j = 12; i &lt;= j; i++ ){
                    _sdate = new Date( _year, i - 1, 1 ); 
                    _edate = new Date( _year, i - 1, maxDayOfMonth( _sdate ) );

                    _title = printf( &quot;{0}年 {1}月&lt;br/&gt;开始日期: {2} (周{4})&lt;br /&gt;结束日期: {3} (周{5})&quot;
                                , _year
                                , JC.Calendar.getCnNum( i )
                                , formatISODate( _sdate )
                                , formatISODate( _edate )
                                , JC.Calendar.cnWeek.charAt( _sdate.getDay() % 7 )
                                , JC.Calendar.cnWeek.charAt( _edate.getDay() % 7 )
                                );

                    _class = [];

                    if( _dateObj.minvalue &amp;&amp; _sdate.getTime() &lt; _dateObj.minvalue.getTime() ) 
                        _class.push( &#x27;unable&#x27; );
                    if( _dateObj.maxvalue &amp;&amp; _edate.getTime() &gt; _dateObj.maxvalue.getTime() ){
                        _class.push( &#x27;unable&#x27; );
                    }

                    if( _date.getTime() &gt;= _sdate.getTime() &amp;&amp; _date.getTime() &lt;= _edate.getTime() ) _class.push( &#x27;cur&#x27; );
                    if( today &gt;= _sdate.getTime() &amp;&amp; today &lt;= _edate.getTime() ) _class.push( &#x27;today&#x27; );

                    _cnUnit = JC.Calendar.cnUnit.charAt( i % 10 );
                    i &gt; 10 &amp;&amp; ( _cnUnit = &quot;十&quot; + _cnUnit );

                    _ls.push( printf( &#x27;&lt;td class=&quot;{0}&quot;&gt;&lt;a href=&quot;javascript:&quot; title=&quot;{1}&quot;&#x27;+
                                    &#x27; dstart=&quot;{3}&quot; dend=&quot;{4}&quot; month=&quot;{5}&quot; &gt;{2}月&lt;/a&gt;&lt;/td&gt;&#x27;
                                , _class.join(&#x27; &#x27;)
                                , _title
                                , _cnUnit
                                , _sdate.getTime()
                                , _edate.getTime()
                                , i
                            ));
                    if( i % 3 === 0 &amp;&amp; i != j ) _ls.push( &#x27;&lt;/tr&gt;&lt;tr&gt;&#x27; );
                }
                _ls.push(&#x27;&lt;/tr&gt;&#x27;); 
 
                _layout.find(&#x27;table.UTableBorder tbody&#x27; ).html( $( _ls.join(&#x27;&#x27;) ) );

            }
        /**
         * 最后一个显示日历组件的日期对象
         * @property    _logic.lastDateObj
         * @type        Object
         * @private
         */
        , lastDateObj: null
        , tpl:
            [
            &#x27;&lt;div id=&quot;UXCCalendar_month&quot; class=&quot;UXCCalendar UXCCalendar_week UXCCalendar_month&quot; &gt;&#x27;
            ,&#x27;    &lt;div class=&quot;UHeader&quot;&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UButton UNextYear&quot;&gt;&amp;nbsp;&amp;gt;&amp;gt;&amp;nbsp;&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UButton UPreYear&quot;&gt;&amp;nbsp;&amp;lt;&amp;lt;&amp;nbsp;&lt;/button&gt;&#x27;
            ,&#x27;        &lt;select class=&quot;UYear&quot; style=&quot;&quot;&gt;&lt;/select&gt;&#x27;
            ,&#x27;    &lt;/div&gt;&#x27;
            ,&#x27;    &lt;table class=&quot;UTable UTableBorder&quot;&gt;&#x27;
            ,&#x27;        &lt;tbody&gt;&lt;/tbody&gt;&#x27;
            ,&#x27;    &lt;/table&gt;&#x27;
            ,&#x27;    &lt;div class=&quot;UFooter&quot;&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UConfirm&quot;&gt;确定&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UClear&quot;&gt;清空&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UCancel&quot;&gt;取消&lt;/button&gt;&#x27;
            ,&#x27;    &lt;/div&gt;&#x27;
            ,&#x27;&lt;/div&gt;&#x27;
            ].join(&#x27;&#x27;)
    };

    $(document).delegate(&#x27;#UXCCalendar_month table a&#x27;, &#x27;click&#x27;, function( _evt ){
        var _p = $(this), dstart = new Date(), dend = new Date()
            , _isMultiselect = JC.Calendar.isMultiSelect()
            , _td = _p.parent(&#x27;td&#x27;)
        ;
        if( !JC.Calendar.lastIpt ) return;
        if( _td.hasClass( &#x27;unable&#x27; ) ) return;
        dstart.setTime( _p.attr(&#x27;dstart&#x27;) );
        dend.setTime( _p.attr(&#x27;dend&#x27;) );

        if( _isMultiselect ){
            UXC.log( &#x27;_isMultiselect&#x27;, new Date().getTime() );
            _td.toggleClass( &#x27;cur&#x27; );
            return; 
        }

        JC.Calendar.lastIpt.val( printf( &#x27;{0} 至 {1}&#x27;, formatISODate( dstart ), formatISODate( dend ) ) );
        JC.Calendar.hide();
        JC.Calendar._triggerUpdate( [ &#x27;month&#x27;, dstart, dend] );
    });

}(jQuery));

(function($){
    /**
     * 弹出一年中所有季度的选择框
     * @method  pickSeason
     * @for     JC.Calendar
     * @static
     * @param   {selector}  _selector
     */
    JC.Calendar.pickSeason =
        function( _selector ){
            _logic.lastDateObj = JC.Calendar.getDate( _selector );
            JC.Calendar.lastIpt = _selector;
            JC.Calendar.setPosition( _selector, _logic.update( _logic.lastDateObj ) );
        };
    /**
     * 自定义周弹框的模板HTML
     * @for         JC.Calendar
     * @property    pickSeason.tpl
     * @type        string
     * @default     empty
     * @static
     */
    JC.Calendar.pickSeason.tpl = &#x27;&#x27;;

    var _logic = {
        getLayout:
            function(){
                var _box
                if( !( _box = $(&#x27;#UXCCalendar_season&#x27;) ).length ){
                    _box = $( JC.Calendar.pickSeason.tpl || _logic.tpl ); 
                    _box.appendTo( document.body );
                    _box.data(&#x27;confirmMethod&#x27;, _logic.onConfirm );
                    _box.data(&#x27;updateYearMethod&#x27;, _logic.updateYear );
                    _box.data(&#x27;nextYearMethod&#x27;, _logic.nextYear );
                    _box.data(&#x27;preYearMethod&#x27;, _logic.preYear );
                }
                return _box;
            }

        , onConfirm:
            function(){
                JC.log( &#x27;Calendar.pickSeason, onConfirm&#x27; );
                var _cur = _logic.getLayout().find(&#x27;td.cur&#x27;);
                if( !_cur.length ) _logic.getLayout().find(&#x27;td.today&#x27;);
                if( _cur.length &amp;&amp; _cur.hasClass(&#x27;unable&#x27;) ) return 0;
                if( _cur.length ) _cur.find(&#x27;a&#x27;).trigger(&#x27;click&#x27;);
            }
        , updateYear:
            function( _val ){
                if( !_logic.lastDateObj ) return;
                _logic.lastDateObj.date.setFullYear( _val );
                JC.Calendar.updateInitYearList( _logic.lastDateObj );
                _logic.update( _logic.lastDateObj );
            }
        , nextYear:
            function(){
                JC.log( &#x27;nextYearMethod&#x27; );
                if( !_logic.lastDateObj ) return;
                _logic.updateYear( _logic.lastDateObj.date.getFullYear() + 1)
            }
        , preYear:
            function(){
                JC.log( &#x27;preYearMethod&#x27; );
                if( !_logic.lastDateObj ) return;
                _logic.updateYear( _logic.lastDateObj.date.getFullYear() - 1)
            }
        , update:
            function( _dateObj ){
                _logic.getLayout();
                _logic.updateHead( _dateObj );
                _logic.updateBody( _dateObj );
                return _logic.getLayout();
            }
        , updateHead:
            function( _dateObj ){
                var _layout = _logic.getLayout(), _ls = [], _tmp, _selected
                    , _sYear = _dateObj.initMinvalue.getFullYear()
                    , _eYear = _dateObj.initMaxvalue.getFullYear();


                if( !_selected ) _selected = _dateObj.date.getFullYear();

                for( var i = _sYear; i &lt;= _eYear; i++ ){
                    _tmp = &#x27;&#x27;;
                    if( _selected === i ) _tmp = &quot; selected &quot;
                    _ls.push( &#x27;&lt;option value=&quot;&#x27;+i+&#x27;&quot;&#x27;+_tmp+&#x27;&gt;&#x27;+i+&#x27;&lt;/option&gt;&#x27; );
                }

                $( _ls.join(&#x27;&#x27;) ).appendTo( _layout.find(&#x27;select.UYear&#x27;).html(&#x27;&#x27;) );

            }
        , updateBody:
            function( _dateObj ){
                var _date = _dateObj.date;
                var _layout = _logic.getLayout();
                    _layout.find(&#x27;button.UYearButton&#x27;).html( _date.getFullYear() );

                var today = new Date( new Date().getFullYear(), new Date().getMonth(), new Date().getDate() ).getTime();
                var _ls = [], _class, _data, _title, _sdate, _edate, _cnUnit
                    , _year = _date.getFullYear();

                var ipt = JC.Calendar.lastIpt, currentcanselect = parseBool( ipt.attr(&#x27;currentcanselect&#x27;) );

                if( _dateObj.maxvalue &amp;&amp; currentcanselect ){
                    var _m = _dateObj.maxvalue.getMonth() + 1, _md;

                    if( _m % 3 !== 0 ){
                        _dateObj.maxvalue.setDate( 1 );
                        _dateObj.maxvalue.setMonth( _m + ( 3 - ( _m % 3 ) - 1 ) );
                    }
                    _dateObj.maxvalue.setDate( maxDayOfMonth( _dateObj.maxvalue ) );
                }

                _ls.push(&#x27;&lt;tr&gt;&#x27;);
                for( i = 1, j = 4; i &lt;= j; i++ ){
                    _sdate = new Date( _year, i * 3 - 3, 1 ); 
                    _edate = new Date( _year, i * 3 - 1, 1 );
                    _edate.setDate( maxDayOfMonth( _edate ) );

                    _cnUnit = JC.Calendar.cnUnit.charAt( i % 10 );
                    i &gt; 10 &amp;&amp; ( _cnUnit = &quot;十&quot; + _cnUnit );

                    _title = printf( &quot;{0}年 第{1}季度&lt;br/&gt;开始日期: {2} (周{4})&lt;br /&gt;结束日期: {3} (周{5})&quot;
                                , _year
                                , JC.Calendar.getCnNum( i )
                                , formatISODate( _sdate )
                                , formatISODate( _edate )
                                , JC.Calendar.cnWeek.charAt( _sdate.getDay() % 7 )
                                , JC.Calendar.cnWeek.charAt( _edate.getDay() % 7 )
                                );

                    _class = [];

                    if( _dateObj.minvalue &amp;&amp; _sdate.getTime() &lt; _dateObj.minvalue.getTime() ) 
                        _class.push( &#x27;unable&#x27; );
                    if( _dateObj.maxvalue &amp;&amp; _edate.getTime() &gt; _dateObj.maxvalue.getTime() ){
                        _class.push( &#x27;unable&#x27; );
                    }

                    if( _date.getTime() &gt;= _sdate.getTime() &amp;&amp; _date.getTime() &lt;= _edate.getTime() ) _class.push( &#x27;cur&#x27; );
                    if( today &gt;= _sdate.getTime() &amp;&amp; today &lt;= _edate.getTime() ) _class.push( &#x27;today&#x27; );


                    _ls.push( printf( &#x27;&lt;td class=&quot;{0}&quot;&gt;&lt;a href=&quot;javascript:&quot; title=&quot;{1}&quot;&#x27;+
                                    &#x27; dstart=&quot;{3}&quot; dend=&quot;{4}&quot; month=&quot;{5}&quot; &gt;{2}季度&lt;/a&gt;&lt;/td&gt;&#x27;
                                , _class.join(&#x27; &#x27;)
                                , _title
                                , _cnUnit
                                , _sdate.getTime()
                                , _edate.getTime()
                                , i
                            ));
                    if( i % 2 === 0 &amp;&amp; i != j ) _ls.push( &#x27;&lt;/tr&gt;&lt;tr&gt;&#x27; );
                }
                _ls.push(&#x27;&lt;/tr&gt;&#x27;); 
 
                _layout.find(&#x27;table.UTableBorder tbody&#x27; ).html( $( _ls.join(&#x27;&#x27;) ) );

            }
        /**
         * 最后一个显示日历组件的日期对象
         * @property    _logic.lastDateObj
         * @type        Object
         * @private
         */
        , lastDateObj: null
        , tpl:
            [
            &#x27;&lt;div id=&quot;UXCCalendar_season&quot; class=&quot;UXCCalendar UXCCalendar_week UXCCalendar_season&quot; &gt;&#x27;
            ,&#x27;    &lt;div class=&quot;UHeader&quot;&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UButton UNextYear&quot;&gt;&amp;nbsp;&amp;gt;&amp;gt;&amp;nbsp;&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UButton UPreYear&quot;&gt;&amp;nbsp;&amp;lt;&amp;lt;&amp;nbsp;&lt;/button&gt;&#x27;
            ,&#x27;        &lt;select class=&quot;UYear&quot; style=&quot;&quot;&gt;&lt;/select&gt;&#x27;
            ,&#x27;    &lt;/div&gt;&#x27;
            ,&#x27;    &lt;table class=&quot;UTable UTableBorder&quot;&gt;&#x27;
            ,&#x27;        &lt;tbody&gt;&lt;/tbody&gt;&#x27;
            ,&#x27;    &lt;/table&gt;&#x27;
            ,&#x27;    &lt;div class=&quot;UFooter&quot;&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UConfirm&quot;&gt;确定&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UClear&quot;&gt;清空&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UCancel&quot;&gt;取消&lt;/button&gt;&#x27;
            ,&#x27;    &lt;/div&gt;&#x27;
            ,&#x27;&lt;/div&gt;&#x27;
            ].join(&#x27;&#x27;)
    };

    $(document).delegate(&#x27;#UXCCalendar_season table a&#x27;, &#x27;click&#x27;, function( _evt ){
        var _p = $(this), dstart = new Date(), dend = new Date();
        if( !JC.Calendar.lastIpt ) return;
        if( _p.parent(&#x27;td&#x27;).hasClass( &#x27;unable&#x27; ) ) return;
        dstart.setTime( _p.attr(&#x27;dstart&#x27;) );
        dend.setTime( _p.attr(&#x27;dend&#x27;) );
        JC.Calendar.lastIpt.val( printf( &#x27;{0} 至 {1}&#x27;, formatISODate( dstart ), formatISODate( dend ) ) );
        JC.Calendar.hide();
        JC.Calendar._triggerUpdate( [ &#x27;season&#x27;, dstart, dend] );
    });

}(jQuery));

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
