/*!
 * jQuery Raty - A Star Rating Plugin
 *
 * Licensed under The MIT License
 *
 * @version        2.5.2
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/raty
 *
 */
;(function(c){var d={init:function(a){return this.each(function(){d.destroy.call(this);this.opt=c.extend(true,{},c.fn.raty.defaults,a);var h=c(this),k=["number","readOnly","score","scoreName"];d._callback.call(this,k);if(this.opt.precision){d._adjustPrecision.call(this)}this.opt.number=d._between(this.opt.number,0,this.opt.numberMax);this.opt.path=this.opt.path||"";if(this.opt.path&&this.opt.path.slice(this.opt.path.length-1,this.opt.path.length)!=="/"){this.opt.path+="/"}this.stars=d._createStars.call(this);this.score=d._createScore.call(this);d._apply.call(this,this.opt.score);var b=this.opt.space?4:0,j=this.opt.width||(this.opt.number*this.opt.size+this.opt.number*b);if(this.opt.cancel){this.cancel=d._createCancel.call(this);j+=(this.opt.size+b)}if(this.opt.readOnly){d._lock.call(this)}else{h.css("cursor","pointer");d._binds.call(this)}if(this.opt.width!==false){h.css("width",j)}d._target.call(this,this.opt.score);h.data({settings:this.opt,raty:true})})},_adjustPrecision:function(){this.opt.targetType="score";this.opt.half=true},_apply:function(a){if(a&&a>0){a=d._between(a,0,this.opt.number);this.score.val(a)}d._fill.call(this,a);if(a){d._roundStars.call(this,a)}},_between:function(b,f,a){return Math.min(Math.max(parseFloat(b),f),a)},_binds:function(){if(this.cancel){d._bindCancel.call(this)}d._bindClick.call(this);d._bindOut.call(this);d._bindOver.call(this)},_bindCancel:function(){d._bindClickCancel.call(this);d._bindOutCancel.call(this);d._bindOverCancel.call(this)},_bindClick:function(){var b=this,a=c(b);b.stars.on("click.raty",function(f){b.score.val((b.opt.half||b.opt.precision)?a.data("score"):this.alt);if(b.opt.click){b.opt.click.call(b,parseFloat(b.score.val()),f)}})},_bindClickCancel:function(){var a=this;a.cancel.on("click.raty",function(b){a.score.removeAttr("value");if(a.opt.click){a.opt.click.call(a,null,b)}})},_bindOut:function(){var a=this;c(this).on("mouseleave.raty",function(b){var f=parseFloat(a.score.val())||undefined;d._apply.call(a,f);d._target.call(a,f,b);if(a.opt.mouseout){a.opt.mouseout.call(a,f,b)}})},_bindOutCancel:function(){var a=this;a.cancel.on("mouseleave.raty",function(b){c(this).attr("src",a.opt.path+a.opt.cancelOff);if(a.opt.mouseout){a.opt.mouseout.call(a,a.score.val()||null,b)}})},_bindOverCancel:function(){var a=this;a.cancel.on("mouseover.raty",function(b){c(this).attr("src",a.opt.path+a.opt.cancelOn);a.stars.attr("src",a.opt.path+a.opt.starOff);d._target.call(a,null,b);if(a.opt.mouseover){a.opt.mouseover.call(a,null)}})},_bindOver:function(){var a=this,f=c(a),b=a.opt.half?"mousemove.raty":"mouseover.raty";a.stars.on(b,function(l){var k=parseInt(this.alt,10);if(a.opt.half){var m=parseFloat((l.pageX-c(this).offset().left)/a.opt.size),e=(m>0.5)?1:0.5;k=k-1+e;d._fill.call(a,k);if(a.opt.precision){k=k-e+m}d._roundStars.call(a,k);f.data("score",k)}else{d._fill.call(a,k)}d._target.call(a,k,l);if(a.opt.mouseover){a.opt.mouseover.call(a,k,l)}})},_callback:function(a){for(i in a){if(typeof this.opt[a[i]]==="function"){this.opt[a[i]]=this.opt[a[i]].call(this)}}},_createCancel:function(){var b=c(this),a=this.opt.path+this.opt.cancelOff,f=c("<img />",{src:a,alt:"x",title:this.opt.cancelHint,"class":"raty-cancel"});if(this.opt.cancelPlace=="left"){b.prepend("&#160;").prepend(f)}else{b.append("&#160;").append(f)}return f},_createScore:function(){return c("<input />",{type:"hidden",name:this.opt.scoreName}).appendTo(this)},_createStars:function(){var h=c(this);for(var b=1;b<=this.opt.number;b++){var g=d._getHint.call(this,b),a=(this.opt.score&&this.opt.score>=b)?"starOn":"starOff";a=this.opt.path+this.opt[a];c("<img />",{src:a,alt:b,title:g}).appendTo(this);if(this.opt.space){h.append((b<this.opt.number)?"&#160;":"")}}return h.children("img")},_error:function(a){c(this).html(a);c.error(a)},_fill:function(b){var o=this,a=0;for(var u=1;u<=o.stars.length;u++){var t=o.stars.eq(u-1),p=o.opt.single?(u==b):(u<=b);if(o.opt.iconRange&&o.opt.iconRange.length>a){var r=o.opt.iconRange[a],s=r.on||o.opt.starOn,n=r.off||o.opt.starOff,q=p?s:n;if(u<=r.range){t.attr("src",o.opt.path+q)}if(u==r.range){a++}}else{var q=p?"starOn":"starOff";t.attr("src",this.opt.path+this.opt[q])}}},_getHint:function(a){var b=this.opt.hints[a-1];return(b==="")?"":(b||a)},_lock:function(){var a=parseInt(this.score.val(),10),b=a?d._getHint.call(this,a):this.opt.noRatedMsg;c(this).data("readonly",true).css("cursor","").attr("title",b);this.score.attr("readonly","readonly");this.stars.attr("title",b);if(this.cancel){this.cancel.hide()}},_roundStars:function(b){var f=(b-Math.floor(b)).toFixed(2);if(f>this.opt.round.down){var a="starOn";if(this.opt.halfShow&&f<this.opt.round.up){a="starHalf"}else{if(f<this.opt.round.full){a="starOff"}}this.stars.eq(Math.ceil(b)-1).attr("src",this.opt.path+this.opt[a])}},_target:function(g,a){if(this.opt.target){var h=c(this.opt.target);if(h.length===0){d._error.call(this,"Target selector invalid or missing!")}if(this.opt.targetFormat.indexOf("{score}")<0){d._error.call(this,'Template "{score}" missing!')}var b=a&&a.type=="mouseover";if(g===undefined){g=this.opt.targetText}else{if(g===null){g=b?this.opt.cancelHint:this.opt.targetText}else{if(this.opt.targetType=="hint"){g=d._getHint.call(this,Math.ceil(g))}else{if(this.opt.precision){g=parseFloat(g).toFixed(1)}}if(!b&&!this.opt.targetKeep){g=this.opt.targetText}}}if(g){g=this.opt.targetFormat.toString().replace("{score}",g)}if(h.is(":input")){h.val(g)}else{h.html(g)}}},_unlock:function(){c(this).data("readonly",false).css("cursor","pointer").removeAttr("title");this.score.removeAttr("readonly","readonly");for(var a=0;a<this.opt.number;a++){this.stars.eq(a).attr("title",d._getHint.call(this,a+1))}if(this.cancel){this.cancel.css("display","")}},cancel:function(a){return this.each(function(){if(c(this).data("readonly")!==true){d[a?"click":"score"].call(this,null);this.score.removeAttr("value")}})},click:function(a){return c(this).each(function(){if(c(this).data("readonly")!==true){d._apply.call(this,a);if(!this.opt.click){d._error.call(this,'You must add the "click: function(score, evt) { }" callback.')}this.opt.click.call(this,a,{type:"click"});d._target.call(this,a)}})},destroy:function(){return c(this).each(function(){var a=c(this),b=a.data("raw");if(b){a.off(".raty").empty().css({cursor:b.style.cursor,width:b.style.width}).removeData("readonly")}else{a.data("raw",a.clone()[0])}})},getScore:function(){var a=[],b;c(this).each(function(){b=this.score.val();a.push(b?parseFloat(b):undefined)});return(a.length>1)?a:a[0]},readOnly:function(a){return this.each(function(){var b=c(this);if(b.data("readonly")!==a){if(a){b.off(".raty").children("img").off(".raty");d._lock.call(this)}else{d._binds.call(this);d._unlock.call(this)}b.data("readonly",a)}})},reload:function(){return d.set.call(this,{})},score:function(){return arguments.length?d.setScore.apply(this,arguments):d.getScore.call(this)},set:function(a){return this.each(function(){var b=c(this),h=b.data("settings"),g=c.extend({},h,a);b.raty(g)})},setScore:function(a){return c(this).each(function(){if(c(this).data("readonly")!==true){d._apply.call(this,a);d._target.call(this,a)}})}};c.fn.raty=function(a){if(d[a]){return d[a].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof a==="object"||!a){return d.init.apply(this,arguments)}else{c.error("Method "+a+" does not exist!")}}};c.fn.raty.defaults={cancel:false,cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:false,halfShow:true,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseout:undefined,mouseover:undefined,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:"",precision:false,readOnly:false,round:{down:0.25,full:0.6,up:0.76},score:undefined,scoreName:"score",single:false,size:16,space:true,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:undefined,targetFormat:"{score}",targetKeep:false,targetText:"",targetType:"hint",width:undefined}})(jQuery);