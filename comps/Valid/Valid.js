(function(c){!window.JC&&(window.JC={log:function(){}});var b=JC.Valid=window.Valid={check:function(l){l&&(l=c(l));var f=true,l=c(l),e=l.length?l.prop("nodeName").toLowerCase():"";if(l.length){if(e=="form"){var d=b.errorAbort,h;l.is("[errorabort]")&&(d=(_tmp=l.attr("errorabort").toLowerCase())=="false"||_tmp=="0"||(!_tmp)?false:true);for(var g=0,k=l[0].length;g<k;g++){if(c(l[0][g]).is("[ignoreprocess]")){continue}!a.parse(c(l[0][g]))&&(f=false);if(d&&!f){break}}}else{f=a.parse(l)}}return f},clearError:function(d){c(d).each(function(){var e=c(this);JC.log("clearError: "+e.prop("nodeName"));switch(e.prop("nodeName").toLowerCase()){case"form":for(var h=0,f=e[0].length;h<f;h++){var g=c(e[0][h]);if(g.is("[disabled]")){return}a.valid(g,1)}break;default:a.valid(c(this),1);break}})},errorAbort:false,autoTrim:true,formHasValue:function(l,k){var f=false,h,e;l&&(l=c(l));if(l&&l.length){for(var g=0,d=l[0].length;g<d;g++){h=c(l[0][g]);if(h.is("[disabled]")){return}e=h.prop("nodeName").toLowerCase();if(k){if(h.is(k)){continue}}switch(h.prop("type").toLowerCase()){case"select-multiple":case"select-one":case"select":case"file":case"textarea":case"password":case"hidden":case"text":if(c.trim(h.val()).length){return true}break;case"checkbox":case"radio":if(h.prop("checked")){return true}break}}}return f},setValid:function(d,e){a.valid.apply(this,[].slice.apply(arguments))},setError:function(e,d,f){a.error.apply(this,[].slice.apply(arguments))}};b.checkAll=b.check;c(document).delegate("input[type=text], input[type=password], textarea","blur",function(d){JC.Valid.check(this)});c(document).delegate("select, input[type=file]","change",function(d){JC.Valid.check(this)});var a={parse:function(d){var e=true,d=c(d);d.each(function(){if(!a.isValidItem(this)){return}var i=c(this),f=a.getDatatype(i),g=a.getSubdatatype(i),h=i.prop("nodeName").toLowerCase();if(!i.is(":visible")){return}if(i.is("[disabled]")){return}JC.log(f,g);switch(h){case"input":case"textarea":b.autoTrim&&(i.val(c.trim(i.val())));i.val(c.trim(i.val()||""));break}if(i.is("[reqmsg]")){if(!a.datatype.reqmsg(i)){e=false;return}}if(!a.datatype.length(i)){e=false;return}if(f in a.datatype&&i.val()){if(!a.datatype[f](i)){e=false;return}}if(g&&g in a.subdatatype&&(i.val()||g=="alternative")){if(!a.subdatatype[g](i)){e=false;return}}a.valid(i)});return e},isValidItem:function(f){f=c(f);var e,d;f.each(function(){d=c(this);if(d.is("[datatype]")||d.is("[subdatatype]")||d.is("[minlength]")||d.is("[maxlength]")||d.is("[reqmsg]")){e=true}});return e},valid:function(d,e){if(!a.isValidItem(d)){return false}setTimeout(function(){d.removeClass("error");d.find("~ em").show();d.find("~ em.error").hide();d.attr("emel")&&a.getElement(d.attr("emel"),d).hide()},e||150)},error:function(e,d,g){if(!a.isValidItem(e)){return false}var f=arguments;setTimeout(function(){var i=a.getMsg.apply(null,[].slice.call(f)),h;e.addClass("error");e.find("~ em:not(.error)").hide();if(e.is("[emEl]")){(h=a.getElement(e.attr("emEl"),e))&&h.length&&h.addClass("error")}!(h&&h.length)&&(h=e.find("~ em.error"));if(!h.length){(h=c('<em class="error"></em>')).insertAfter(e)}JC.log("error: "+i);h.html(i).show()},150);return false},getElement:function(d,e){if(/^\^$/.test(d)){d=c(e.parent().find("~ em.error"))}else{if(/^[\w-]+$/.test(d)){d="#"+d}}return c(d)},getDatatype:function(d){return(d.attr("datatype")||"text").toLowerCase().replace(/\-.*/,"")},getSubdatatype:function(d){return(d.attr("subdatatype")||"text").toLowerCase().replace(/\-.*/,"")},getMsg:function(d,g,f){var e=d.is("[errmsg]")?" "+d.attr("errmsg"):d.is("[reqmsg]")?d.attr("reqmsg"):"";g&&(e=d.attr(g)||e);f&&e&&(e=" "+e);if(e&&!/^[\s]/.test(e)){switch(d.prop("type").toLowerCase()){case"file":e="请上传"+e;break;case"select-multiple":case"select-one":case"select":e="请选择"+e;break;case"textarea":case"password":case"text":e="请填写"+e;break}}JC.log("_msg: "+e,d.prop("type").toLowerCase());return c.trim(e)},bytelen:function(d){return d.replace(/[^\x00-\xff]/g,"11").length},getTimestamp:function(d){d=d.replace(/[^\d]/g,"");return new Date(d.slice(0,4),parseInt(d.slice(4,6),10)-1,d.slice(6,8)).getTime()},datatype:{n:function(i){var l=true,j=i.val(),e=+j,g=0,k=Math.pow(10,10),d,f,h;if(i.is("[minvalue]")){if(/\./.test(i.attr("minvalue"))){h=parseFloat(i.attr("minvalue"))}else{h=parseInt(i.attr("minvalue"))}if(!isNaN(h)){g+=h}}if(!isNaN(e)&&e>=g){i.attr("datatype").replace(/^n[^\-]*\-(.*)$/,function(m,n){h=n.split(".");d=h[0];f=h[1]});if(i.is("[maxvalue]")){k=+i.attr("maxvalue")||k}if(e>=g&&e<=k){typeof d!="undefined"&&typeof f!="undefined"&&(l=new RegExp("^(?:-|)(?:[\\d]{0,"+d+"}|)(?:\\.[\\d]{1,"+f+"}|)$").test(j));typeof d!="undefined"&&typeof f=="undefined"&&(l=new RegExp("^(?:-|)[\\d]{1,"+d+"}$").test(j));typeof d=="undefined"&&typeof f!="undefined"&&(l=new RegExp("^(?:-|)\\.[\\d]{1,"+f+"}$").test(j));typeof f=="undefined"&&/\./.test(j)&&(l=false)}else{l=false}JC.log("nValid",e,typeof d,typeof f,typeof g,typeof k,g,k)}else{l=false}!l&&a.error(i);return l},nrange:function(i){var g=a.datatype.n(i),k,h;JC.log("zzzz",g);if(g){var e,j;if(i.is("[fromNEl]")){e=a.getElement(i.attr("fromNEl"))}if(i.is("[toNEl]")){j=a.getElement(i.attr("toNEl"))}if(!(e&&e.length||j&&j.length)){var f=i.parent(),d=[];f.find("input[datatype]").each(function(){var l=c(this);/nrange/i.test(l.attr("datatype"))&&d.push(this)});JC.log("ccc",d.length);if(d.length===2){e=c(d[0]);j=c(d[1])}}JC.log("aaaa",g);if(e&&e.length||j&&j.length){e&&e.length&&!(j&&j.length)&&(j=i);!(e&&e.length)&&j&&j.length&&(e=i);JC.log("nrange",e.length,j.length);j.val(c.trim(j.val()));e.val(c.trim(e.val()));if(j[0]!=e[0]&&j.val().length&&e.val().length){g&&(g=a.datatype.n(j));g&&(g=a.datatype.n(e));g&&(+e.val())>(+j.val())&&(g=false);JC.log(+e.val(),+j.val(),g);g&&a.valid(e);g&&a.valid(j);if(g){e.removeClass("error");j.removeClass("error")}else{e.addClass("error");j.addClass("error")}}}}!g&&a.error(i);return g},d:function(g){var f=c.trim(g.val()),j,e=/^[\d]{4}([\/.-]|)[01][\d]\1[0-3][\d]$/;if(!f){return true}if(j=e.test(f)){var d=a.getTimestamp(g.val()),h,i;if(g.is("[minvalue]")&&(j=e.test(g.attr("minvalue")))){h=a.getTimestamp(g.attr("minvalue"));d<h&&(j=false)}if(j&&g.is("[maxvalue]")&&(j=e.test(g.attr("maxvalue")))){i=a.getTimestamp(g.attr("maxvalue"));d>i&&(j=false)}}!j&&a.error(g);return j},daterange:function(i){var g=a.datatype.d(i),k,h;if(g){var e,d;if(i.is("[fromDateEl]")){e=a.getElement(i.attr("fromDateEl"))}if(i.is("[toDateEl]")){d=a.getElement(i.attr("toDateEl"))}if(!(e&&e.length||d&&d.length)){var j=i.parent(),f=j.find("input[datatype=daterange]");if(f.length===2){e=c(f[0]);d=c(f[1])}}if(e&&e.length||d&&d.length){e&&e.length&&!(d&&d.length)&&(d=i);!(e&&e.length)&&d&&d.length&&(e=i);JC.log("daterange",e.length,d.length);d.val(c.trim(d.val()));e.val(c.trim(e.val()));if(d[0]!=e[0]&&d.val().length&&e.val().length){g&&(g=a.datatype.d(d));g&&(g=a.datatype.d(e));g&&a.getTimestamp(e.val())>a.getTimestamp(d.val())&&(g=false);g&&a.valid(e);g&&a.valid(d);if(g){e.removeClass("error");d.removeClass("error")}else{e.addClass("error");d.addClass("error")}}}}!g&&a.error(i);return g},time:function(d){var e=/^(([0-1]\d)|(2[0-3])):[0-5]\d:[0-5]\d$/.test(d.val());!e&&a.error(d);return e},minute:function(d){var e=/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(d.val());!e&&a.error(d);return e},bankcard:function(d){var e=/^[1-9][\d]{3}(?: |)(?:[\d]{4}(?: |))(?:[\d]{4}(?: |))(?:[\d]{4})(?:(?: |)[\d]{3}|)$/.test(d.val());!e&&a.error(d);return e},cnname:function(d){var e=a.bytelen(d.val())<32&&/^[\u4e00-\u9fa5a-zA-Z.\u3002\u2022]{2,32}$/.test(d.val());!e&&a.error(d);return e},username:function(d){var e=/^[a-zA-Z0-9][\w-]{2,30}$/.test(d.val());!e&&a.error(d);return e},idnumber:function(d){var e=/^[0-9]{15}(?:[0-9]{2}(?:[0-9xX])|)$/.test(d.val());!e&&a.error(d);return e},mobilecode:function(d,f){var e=/^(?:13|14|15|16|18|19)[\d]{9}$/.test(d.val());!f&&!e&&a.error(d);return e},mobile:function(e,d){return a.datatype.mobilecode(e,d)},mobilezonecode:function(d,f){var e=/^(?:\+[0-9]{1,6} |)(?:0|)(?:13|14|15|16|18|19)\d{9}$/.test(d.val());!f&&!e&&a.error(d);return e},phonecode:function(d){var e=/^[1-9][0-9]{6,7}$/.test(d.val());!e&&a.error(d);return e},phone:function(d,f){var e=/^(?:0(?:10|2\d|[3-9]\d\d)(?: |\-|)|)[1-9][\d]{6,7}$/.test(d.val());!f&&!e&&a.error(d);return e},phoneall:function(d,f){var e=/^(?:\+[\d]{1,6}(?: |\-)|)(?:0[\d]{2,3}(?:\-| |)|)[1-9][\d]{6,7}(?:(?: |)\#[\d]{1,6}|)$/.test(d.val());!f&&!e&&a.error(d);return e},phonezone:function(d){var e=/^[0-9]{3,4}$/.test(d.val());!e&&a.error(d);return e},phoneext:function(d){var e=/^[0-9]{1,6}$/.test(d.val());!e&&a.error(d);return e},mobilephone:function(d){var e=a.datatype.mobilecode(d,true)||a.datatype.phone(d,true);!e&&a.error(d);return e},mobilephoneall:function(d){var e=a.datatype.mobilezonecode(d,true)||a.datatype.phoneall(d,true);!e&&a.error(d);return e},length:function(h){var e=true,j=a.getDatatype(h),i,g,f=c.trim(h.val()),d;if(!f){return e}if(h.is("[minlength]")){JC.log("minlength");i=parseInt(h.attr("minlength"),10)||0}if(h.is("[maxlength]")){JC.log("maxlength");g=parseInt(h.attr("maxlength"),10)||0}switch(j){case"bytetext":d=a.bytelen(f);break;case"richtext":default:d=f.length;break}i&&(d<i)&&(e=false);g&&(d>g)&&(e=false);JC.log("lengthValid: ",i,g,e);!e&&a.error(h);return e},reqmsg:function(d){var e;if(d.val()&&d.val().constructor==Array){e=!!(c.trim(d.val().join("")+""))}else{e=!!c.trim(d.val()||"")}!e&&a.error(d,"reqmsg");JC.log("regmsgValid: "+e);return e},reg:function(d){var e=true,f;if(d.is("[reg-pattern]")){f=d.attr("reg-pattern")}if(!f){f=c.trim(d.attr("datatype")).replace(/^reg(?:\-|)/i,"")}f.replace(/^\/([\s\S]*)\/([\w]{0,3})$/,function(h,g,i){JC.log(g,i);e=new RegExp(g,i||"").test(d.val())});!e&&a.error(d);return e},vcode:function(d){var e,f=parseInt(c.trim(d.attr("datatype")).replace(/^vcode(?:\-|)/i,""),10)||4;JC.log("vcodeValid: "+f);e=new RegExp("^[0-9a-zA-Z]{"+f+"}$").test(d.val());!e&&a.error(d);return e},text:function(d){return true},bytetext:function(d){return true},richtext:function(d){return true},url:function(d){var e=/^((http|ftp|https):\/\/|)[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])$/.test(d.val());!e&&a.error(d);return e},domain:function(d){var e=/^(?:htt(?:p|ps)\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.(\w{2,6})(?:\/|)$/.test(d.val());!e&&a.error(d);return e},stricdomain:function(d){var e=/^((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.(\w{2,6})$/.test(d.val());!e&&a.error(d);return e},email:function(d){var e=/^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(d.val());!e&&a.error(d);return e},zipcode:function(d){var e=/^[0-9]{6}$/.test(d.val());!e&&a.error(d);return e}},subdatatype:{alternative:function(d){var e=true,g;JC.log("alternative");d.is("[datatarget]")&&(g=c(d.attr("datatarget")));!(g&&g.length)&&(g=d.parent().find("[subdatatype=alternative]"));if(g.length&&!c.trim(d.val())){var f=false;g.each(function(){if(c(this).val()){f=true;return false}});e=f}!e&&a.error(d,"alternativemsg",true);!e&&g&&g.length&&g.each(function(){a.error(c(this),"alternativemsg",true)});e&&g&&g.length&&g.each(function(){a.valid(c(this))});return e},reconfirm:function(d){var e=true,f;JC.log("reconfirm");d.is("[datatarget]")&&(f=c(d.attr("datatarget")));!(f&&f.length)&&(f=d.parent().find("[subdatatype=reconfirm]"));if(f&&f.length){f.each(function(){if(d.val()!=c(this).val()){return e=false}})}!e&&a.error(d,"reconfirmmsg",true);!e&&f.length&&f.each(function(){a.error(c(this),"reconfirmmsg",true)});e&&f.length&&f.each(function(){a.valid(c(this))});return e}}}}(jQuery));