(function(c){!window.JC&&(window.JC={log:function(){}});window.Tree=JC.Tree=d;function d(e,f){if(e&&c(e).length){e=c(e);if(d.getInstance(e)){return d.getInstance(e)}e.data("TreeIns",this)}this._model=new b(e,f);this._view=new a(this._model)}d.getInstance=function(e){e=c(e);return e.data("TreeIns")};d.dataFilter;d.prototype={init:function(){this._view.init();this._view.treeRoot().data("TreeIns",this);return this},open:function(e){if(typeof e=="undefined"){this._view.openAll();return this}this._view.open(e);return this},close:function(e){if(typeof e=="undefined"){this._view.closeAll();return this}this._view.close(e);return this},idPrefix:function(){return this._model.idPrefix()},getItem:function(e){var f;e&&(f=c("#"+this._model.id(e)));return f},on:function(f,e){if(!(f&&e)){return this}this._model.addEvent(f,e);return this},event:function(e){if(!e){return}return this._model.event(e)},highlight:function(e){return this._model.highlight(e)}};function b(e,f){this._container=e;this._data=f;this._id="tree_"+new Date().getTime()+"_";this._highlight;this._events={};this._init()}b.prototype={_init:function(){d.dataFilter&&(this._data=d.dataFilter(this._data));return this},container:function(){return this._container},id:function(e){return this._id+e},idPrefix:function(){return this._id},data:function(){return this._data},root:function(){return this._data.root},child:function(e){return this._data.data[e]},hasChild:function(e){return e in this._data.data},event:function(e){e=e.toLowerCase();return this._events[e]},addEvent:function(f,e){f=f.toLowerCase();if(!(f in this._events)){this._events[f]=[]}this._events[f].unshift(e)},highlight:function(e){e&&(this._highlight=e);return this._highlight}};function a(e){this._model=e;this._treeRoot}a.prototype={init:function(){if(!(this._model.data()&&this._model.root())){return}this._process(this._model.child(this._model.root()[0]),this._initRoot());return this},treeRoot:function(e){e&&(this._treeRoot=e);return this._treeRoot},_process:function(e,f){for(var l=0,h=e.length,k,g;l<h;l++){k=e[l];g=l===h-1;if(this._model.hasChild(k[0])){this._initFolder(f,k,g)}else{this._initFile(f,k,g)}}},_initRoot:function(){var g=this;if(!g._model.data().root){return}var i=g._model.data().root;var f=c('<ul class="tree_wrap"></ul>');var e=this._initLabel(i);var h=c('<li class="folder_open"></li>');h.html('<span class="folder_img_root folderRoot folder_img_open">&nbsp;</span>');e.appendTo(h);h.appendTo(f);f.appendTo(g._model.container());this.treeRoot(f);var j=c('<ul style="" class="tree_wrap_inner"></ul>');j.appendTo(h);return j},_initFolder:function(g,f,h){var l="",j="";h&&(l="folder_span_lst ",j="folder_last");var e=this._initLabel(f);var i=c(printf('<li><span class="folder_img_closed folder {1}">&nbsp;</span></li>',f[1],l));i.addClass(printf("folder_closed {0} folder",j));e.appendTo(i);var k=c('<ul style="display:none;" class="folder_ul_lst" ></ul>');k.appendTo(i);i.appendTo(g);this._process(this._model.child(f[0]),k)},_initFile:function(h,i,k){var g="folder_img_bottom ",j="";k&&(g="folder_img_last ",j="");var f=this._initLabel(i);var e=c(printf('<li><span class="{1}file">&nbsp;</span></li>',i[1],g));e.addClass("folder_closed file");f.appendTo(e);e.appendTo(h)},_initLabel:function(e){var f=c('<div class="node_ctn"></div>');f.attr("id",this._model.id(e[0])).attr("dataid",e[0]).attr("dataname",e[1]).data("nodeData",e);if(this._model.event("RenderLabel")){c.each(this._model.event("RenderLabel"),function(h,g){if(g.call(f,e,f)===false){return false}})}else{f.html(e[1]||"没有标签")}return f},openAll:function(){if(!this.treeRoot()){return}this.treeRoot().find("span.folder_img_closed").each(function(){c(this).trigger("click")})},closeAll:function(){if(!this.treeRoot()){return}this.treeRoot().find("span.folder_img_open, span.folder_img_root").each(function(){if(c(this).hasClass("folder_img_closed")){return}c(this).trigger("click")})},open:function(e){if(!e){return}var g=c("#"+this._model.id(e));if(!g.length){return}var f=g.parents("li");if(this._model.highlight()){this._model.highlight().removeClass("highlight")}g.addClass("highlight");this._model.highlight(g);f.each(function(){var h=c(this),i=h.find("> span.folderRoot, > span.folder");if(i.length){if(i.hasClass("folder_img_open")){return}i.trigger("click")}})},close:function(e){if(!e){return}var g=c("#"+this._model.id(e));if(!g.length){return}var f=g.parent("li").find("> span.folderRoot, > span.folder");if(f.length){if(f.hasClass("folder_img_closed")){return}f.trigger("click")}}};d.lastHover=null;c(document).delegate("ul.tree_wrap div.node_ctn","mouseenter",function(){if(d.lastHover){d.lastHover.removeClass("ms_over")}c(this).addClass("ms_over");d.lastHover=c(this)});c(document).delegate("ul.tree_wrap div.node_ctn","mouseleave",function(){if(d.lastHover){d.lastHover.removeClass("ms_over")}});c(document).delegate("ul.tree_wrap div.node_ctn","click",function(h){var g=c(this),e=g.parents("ul.tree_wrap"),f=e.data("TreeIns");if(!f){return}var i=f.event("click");if(i&&i.length){c.each(i,function(k,j){if(j.call(g,h)===false){return false}})}if(f.highlight()){f.highlight().removeClass("highlight")}g.addClass("highlight");f.highlight(g);var i=f.event("change");if(i&&i.length){c.each(i,function(k,j){if(j.call(g,h)===false){return false}})}});c(document).delegate("ul.tree_wrap span.folder, ul.tree_wrap span.folderRoot","click",function(f){var k=c(this),h=k.parent("li"),g=h.find("> ul");var j=k.parents("ul.tree_wrap"),e=j.data("TreeIns");var i=e.event("FolderClick");if(i&&i.length){c.each(i,function(m,l){if(l.call(k,f)===false){return false}})}if(k.hasClass("folder_img_open")){k.removeClass("folder_img_open").addClass("folder_img_closed");g.hide()}else{if(k.hasClass("folder_img_closed")){k.addClass("folder_img_open").removeClass("folder_img_closed");g.show()}}if(h.hasClass("folder_closed")){h.addClass("folder_open").removeClass("folder_closed")}else{if(h.hasClass("folder_open")){h.removeClass("folder_open").addClass("folder_closed")}}})}(jQuery));