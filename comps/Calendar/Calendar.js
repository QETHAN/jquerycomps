(function(b){!window.JC&&(window.JC={log:function(){}});window.ZINDEX_COUNT=window.ZINDEX_COUNT||50001;var a=JC.Calendar=window.Calendar={pickDate:function(d){d=b(d);if(!(d&&d.length)){return}b("body > div.UXCCalendar").hide();a.lastIpt=d;d=b(d);var e=b.trim(d.attr("multidate")||"").toLowerCase();switch(e){case"week":a.pickWeek&&a.pickWeek(d);break;case"month":a.pickMonth&&a.pickMonth(d);break;case"season":a.pickSeason&&a.pickSeason(d);break;default:c.pickDate(d)}a.layoutInitedCallback&&a.layoutInitedCallback(b("body > div.UXCCalendar:visible"),d)},init:function(d){c.initTrigger(d)},autoInit:true,defaultDateSpan:20,lastIpt:null,setPosition:function(f,l){if(!(f&&l)){return}l.css({left:"-9999px",top:"-9999px","z-index":ZINDEX_COUNT++}).show();var e=l.width(),m=l.height(),h=f.width(),n=f.height(),d=f.offset(),q,o,g=b(window).width(),p=b(window).height(),k=b(document).scrollTop();q=d.left;o=d.top+n+5;if((o+m-k)>p){JC.log("y overflow");o=d.top-m-3;if(o<k){o=k}}l.css({left:q+"px",top:o+"px"});JC.log(e,m,h,n,d.left,d.top,g,p);JC.log(k,q,o)},isCalendarElement:function(d){d=b(d);var e=0;if(d.length){if(d.hasClass("UXCCalendar_btn")){e=1}if(d.prop("nodeName")&&d.attr("datatype")&&d.prop("nodeName").toLowerCase()=="input"&&d.attr("datatype").toLowerCase()=="date"){e=1}if(d.prop("nodeName")&&d.attr("multidate")&&d.prop("nodeName").toLowerCase()=="input"){e=1}}return e},layoutInitedCallback:null,layoutHideCallback:null,domClickFilter:null,hide:function(){b("body > div.UXCCalendar").hide();a.layoutHideCallback&&a.layoutHideCallback(a.lastIpt)},getDate:function(f){var e={date:0,minvalue:0,maxvalue:0,initMinvalue:0,initMaxvalue:0},d;if(d=parseISODate(f.val())){e.date=d}else{if(f.val()&&(d=f.val().replace(/[^\d]/g,"")).length==16){e.date=parseISODate(d.slice(0,8));e.rangeStart=cloneDate(e.date);e.rangeEnd=parseISODate(d.slice(8))}else{e.date=new Date()}}e.minvalue=parseISODate(f.attr("minvalue"));e.maxvalue=parseISODate(f.attr("maxvalue"));a.updateInitYearList(e);return e},updateInitYearList:function(d){d.initMinvalue=cloneDate(d.date);d.initMinvalue.setFullYear(d.initMinvalue.getFullYear()-a.defaultDateSpan);d.initMaxvalue=cloneDate(d.date);d.initMaxvalue.setFullYear(d.initMaxvalue.getFullYear()+a.defaultDateSpan)},cnWeek:"日一二三四五六",cnUnit:"十一二三四五六七八九",getCnNum:function(d){var e=a.cnUnit.charAt(d%10);d>10&&(e=(d%10!==0?a.cnUnit.charAt(0):"")+e);d>19&&(e=a.cnUnit.charAt(Math.floor(d/10))+e);return e},tpl:""};var c={initTrigger:function(d){d.each(function(){var g=b(this),f=(g.prop("nodeName")||"").toLowerCase();JC.log("\nCalendar.init: ",f);if(f!="input"){c.initTrigger(d.find(b("input[type=text]")));return}if(!(b.trim(g.attr("datatype")||"").toLowerCase()=="date"||b.trim(g.attr("multidate")||"")||b.trim(g.attr("datatype")||"").toLowerCase()=="daterange")){return}JC.log("find Calendar item:",g.attr("name"),g.attr("id"),g.attr("datatype"));var e=g.find("+ input.UXCCalendar_btn");if(!e.length){g.after(e=b('<input type="button" class="UXCCalendar_btn"  />'))}e[0].forCalendar=g})},lastDateObj:null,pickDate:function(d){JC.log("Calendar.pickDate",new Date().getTime());d=b(d);var e=c.lastDateObj=a.getDate(d);JC.log(e.date.getFullYear(),e.date.getMonth()+1,e.date.getDate());c.initDateLayout(e);a.setPosition(d,c.getLayout());d.blur()},initDateLayout:function(d){a.updateInitYearList(d);c.initYear(d);c.initMonth(d);c.initMonthDate(d)},initMonthDate:function(r){var t=c.getLayout();var s=maxDayOfMonth(r.date),m=r.date.getDay()||7,p=m+s,e=6,v=[],d,u,k,g,h;var f=new Date(r.date.getFullYear(),r.date.getMonth(),1);var q=f.getDay()||7;if(q<2){f.setDate(-(q-1+6))}else{f.setDate(-(q-2))}var l=new Date();var o=JC.Calendar.lastIpt,n=true;if(o.is("[currentcanselect]")){n=parseBool(o.attr("currentcanselect"))}if(r.maxvalue&&!n){r.maxvalue.setDate(r.maxvalue.getDate()-1)}v.push("<tr>");for(g=1;g<=42;g++){h=[];if(f.getDay()===0||f.getDay()==6){h.push("weekend")}if(!isSameMonth(r.date,f)){h.push("other")}if(r.minvalue&&f.getTime()<r.minvalue.getTime()){h.push("unable")}if(r.maxvalue&&f.getTime()>r.maxvalue.getTime()){h.push("unable")}if(isSameDay(f,l)){h.push("today")}if(isSameDay(r.date,f)){h.push("cur")}v.push('<td class="',h.join(" "),'">','<a href="javascript:" date="',f.getTime(),'" title="'+formatISODate(f)+'" >',f.getDate(),"</a></td>");f.setDate(f.getDate()+1);if(g%7===0&&g!=42){v.push("</tr><tr>")}}v.push("</tr>");t.find("table.UTableBorder tbody").html(b(v.join("")));JC.log(u,d,s,m,p,e)},initMonth:function(d){var e=c.getLayout();b(e.find("select.UMonth").val(d.date.getMonth()))},initYear:function(d){var e=c.getLayout(),m=[],h,k,g=d.initMinvalue.getFullYear(),l=d.initMaxvalue.getFullYear();JC.log(g,l);if(!k){k=d.date.getFullYear()}for(var f=g;f<=l;f++){h="";if(k===f){h=" selected "}m.push('<option value="'+f+'"'+h+">"+f+"</option>")}b(m.join("")).appendTo(e.find("select.UYear").html(""))},updateYear:function(d){JC.log(d);if(!c.lastDateObj){return}var e=maxDayOfMonth(c.lastDateObj.date),g=new Date(d,c.lastDateObj.date.getMonth(),1),f=maxDayOfMonth(g);if(e>f){g.setDate(f)}else{g.setDate(c.lastDateObj.date.getDate())}c.lastDateObj.date=g;c.initDateLayout(c.lastDateObj)},setNewMonth:function(d){JC.log(d);if(!c.lastDateObj){return}var e=maxDayOfMonth(c.lastDateObj.date),g=new Date(c.lastDateObj.date.getFullYear(),d,1),f=maxDayOfMonth(g);if(e>f){g.setDate(f)}else{g.setDate(c.lastDateObj.date.getDate())}c.lastDateObj.date=g;c.initMonth(c.lastDateObj);c.initMonthDate(c.lastDateObj)},getLayout:function(){var e=b("#UXCCalendar");if(!e.length){e=b(a.tpl||c.tpl);e.attr("id","UXCCalendar").hide().appendTo(document.body);var d=b(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(e.find("select.UMonth"));e.hide();e.data("confirmMethod",c.onConfirm);e.data("updateYearMethod",c.updateYear)}return e},setDate:function(f){if(!(f&&a.lastIpt&&a.lastIpt.length)){return}var h=new Date(),g="-";h.setTime(f);var d=a.lastIpt.attr("dateFormat");if(d){d=d.replace(/[\da-zA-Z]/g,"");if(d.length){d=d.slice(0,1)}g=d}var e=formatISODate(h,g);a.lastIpt.val(e).focus()},onConfirm:function(){var d;d=c.getLayout().find("table td.cur a");if(d.parent("td").hasClass("unable")){return 0}d&&d.length&&d.attr("date")&&c.setDate(d.attr("date"));return 1},tpl:['<div id="UXCCalendar" class="UXCCalendar">\n','    <div class="UHeader">\n','        <select class="UYear"></select>\n','        <img class="UImg yearctl" align="absMiddle" usemap="#UXCCalendar_Year" />\n','        <map name="UXCCalendar_Year"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>\n','        <select class="UMonth"></select>\n','        <img class="UImg monthctl" align="absMiddle" usemap="#UXCCalendar_Month"  />\n','        <map name="UXCCalendar_Month"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>\n',"    </div>\n",'    <table class="UTable">\n',"        <thead>\n","            <tr>\n","                <th>一</th>\n","                <th>二</th>\n","                <th>三</th>\n","                <th>四</th>\n","                <th>五</th>\n","                <th>六</th>\n","                <th>日</th>\n","            </tr>\n","        </thead>\n","   </table>\n",'   <table class="UTable UTableBorder">\n',"        <tbody>\n","           <!--<tr>\n",'                <td class="cur"><a href="#">2</a></td>\n','                <td class="unable"><a href="#">2</a></td>\n','                <td class="weekend cur"><a href="#">6</a></td>\n','                <td class="weekend hover"><a href="#">13</a></td>\n','                <td class="weekend other"><a href="#">41</a></td>\n','                <td class="weekend other"><a href="#">42</a></td>\n',"            </tr>\n-->","        </tbody>\n","    </table>\n",'    <div class="UFooter">\n','        <button type="button" class="UConfirm">确定</button>\n','        <button type="button" class="UClear">清空</button>\n','        <button type="button" class="UCancel">取消</button>\n',"    </div>\n","</div>\n"].join("")};b(document).ready(function(d){setTimeout(function(e){if(!a.autoInit){return}a.init(b("input[type=text]"))},200);b(document).delegate("body > div.UXCCalendar select.UYear","change",function(f){var e=b(this).parents("div.UXCCalendar");e.length&&e.data("updateYearMethod")&&e.data("updateYearMethod")(b(this).val())});b(document).delegate("body > div.UXCCalendar button.UNextYear","click",function(f){var e=b(this).parents("div.UXCCalendar");e.length&&e.data("nextYearMethod")&&e.data("nextYearMethod")()});b(document).delegate("body > div.UXCCalendar button.UPreYear","click",function(f){var e=b(this).parents("div.UXCCalendar");e.length&&e.data("preYearMethod")&&e.data("preYearMethod")()});b(document).delegate("#UXCCalendar select.UMonth","change",function(e){c.setNewMonth(b(this).val())});b(document).delegate("body > div.UXCCalendar button.UConfirm","click",function(f){var e=b(this).parents("div.UXCCalendar"),g;if(e.length&&(g=e.find("td.cur")).length){if(g.hasClass("unable")){return}}e.length&&e.data("confirmMethod")&&e.data("confirmMethod")(this);a.hide()});b(document).delegate("map[name=UXCCalendar_Year] area","click",function(g){g.preventDefault();var f=b(this),e=c.lastDateObj;if(!(e&&f.attr("action"))){return}if(f.attr("action").toLowerCase()=="up"){e.date.setFullYear(e.date.getFullYear()+1)}else{if(f.attr("action").toLowerCase()=="down"){e.date.setFullYear(e.date.getFullYear()-1)}}c.initDateLayout(e);JC.log(f.attr("action"))});b(document).delegate("map[name=UXCCalendar_Month] area","click",function(g){g.preventDefault();var f=b(this),e=c.lastDateObj;if(!(e&&f.attr("action"))){return}if(f.attr("action").toLowerCase()=="up"){e.date.setMonth(e.date.getMonth()+1);e.initMinvalue.setMonth(e.initMinvalue.getMonth()+1);e.initMaxvalue.setMonth(e.initMaxvalue.getMonth()+1)}else{if(f.attr("action").toLowerCase()=="down"){e.date.setMonth(e.date.getMonth()-1);e.initMinvalue.setMonth(e.initMinvalue.getMonth()-1);e.initMaxvalue.setMonth(e.initMaxvalue.getMonth()-1)}}c.initDateLayout(e);JC.log(f.attr("action"))});b(document).delegate("body > div.UXCCalendar button.UClear","click",function(e){a.lastIpt&&a.lastIpt.length&&a.lastIpt.val("")});b(document).delegate("body > div.UXCCalendar button.UCancel","click",function(e){a.hide()});b(document).on("click",function(f){var e=f.target||f.srcElement;if(a.domClickFilter){if(a.domClickFilter(b(e))===false){return}}if(a.isCalendarElement(f.target||f.targetElement)){return}if(e&&e.nodeName.toLowerCase()!="input"){a.hide();return}setTimeout(function(){if(a.lastIpt&&a.lastIpt.length&&e==a.lastIpt[0]){return}a.hide()},100)});b(document).delegate("input.UXCCalendar_btn","click",function(e){if(this.forCalendar){a.pickDate(this.forCalendar)}});b(document).delegate("input[datatype=date], input[datatype=daterange], input[multidate]","focus",function(e){a.pickDate(this)});b(document).delegate("body > div.UXCCalendar","click",function(e){e.stopPropagation()});b(document).delegate("#UXCCalendar table a","click",function(g){g.preventDefault();var f=b(this),e=f.attr("date")||"";if(!e){return}if(f.parent("td").hasClass("unable")){return}JC.log(e);c.setDate(e);a.hide()});b(window).on("scroll resize",function(f){var e=b("body > div.UXCCalendar:visible");if(!(e.length&&a.lastIpt)){return}a.setPosition(a.lastIpt,e)})})}(jQuery));(function(c){JC.Calendar.pickWeek=function(d){a.lastDateObj=JC.Calendar.getDate(d);JC.Calendar.lastIpt=d;JC.Calendar.setPosition(d,a.update(a.lastDateObj))};JC.Calendar.pickWeek.tpl="";JC.Calendar.pickWeek.dayOffset=1;var a={getLayout:function(){var d;if(!(d=c("#UXCCalendar_week")).length){d=c(JC.Calendar.pickWeek.tpl||a.tpl);d.appendTo(document.body);d.data("confirmMethod",a.onConfirm);d.data("updateYearMethod",a.updateYear);d.data("nextYearMethod",a.nextYear);d.data("preYearMethod",a.preYear)}return d},onConfirm:function(){JC.log("Calendar.pickWeek, onConfirm");var d=a.getLayout().find("td.cur");if(!d.length){a.getLayout().find("td.today")}if(d.length){d.find("a").trigger("click")}},updateYear:function(d){if(!a.lastDateObj){return}a.lastDateObj.date.setFullYear(d);JC.Calendar.updateInitYearList(a.lastDateObj);a.update(a.lastDateObj)},nextYear:function(){JC.log("nextYearMethod");if(!a.lastDateObj){return}a.updateYear(a.lastDateObj.date.getFullYear()+1)},preYear:function(){JC.log("preYearMethod");if(!a.lastDateObj){return}a.updateYear(a.lastDateObj.date.getFullYear()-1)},update:function(d){a.getLayout();a.updateHead(d);a.updateBody(d);return a.getLayout()},updateHead:function(d){var e=a.getLayout(),m=[],h,k,g=d.initMinvalue.getFullYear(),l=d.initMaxvalue.getFullYear();if(!k){k=d.date.getFullYear()}for(var f=g;f<=l;f++){h="";if(k===f){h=" selected "}m.push('<option value="'+f+'"'+h+">"+f+"</option>")}c(m.join("")).appendTo(e.find("select.UYear").html(""))},updateBody:function(f){var q=f.date;var m=a.getLayout();m.find("button.UYearButton").html(q.getFullYear());var u=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime();var n=b(q.getFullYear(),JC.Calendar.pickWeek.dayOffset);var l=b(q.getFullYear()+1,JC.Calendar.pickWeek.dayOffset);var o=0;var v=[],g,s,r,p,h,k=q.getFullYear(),e=Math.ceil(n.length/8);var t=JC.Calendar.lastIpt,d=parseBool(t.attr("currentcanselect"));if(f.maxvalue&&d){var w=f.maxvalue.getDay();if(w>0){f.maxvalue.setDate(f.maxvalue.getDate()+(7-w))}}v.push("<tr>");for(i=1,j=e*8;i<=j;i++){s=n[i-1];if(!s){s=l[o++];k=q.getFullYear()+1}p=new Date();h=new Date();p.setTime(s.start);h.setTime(s.end);r=printf("{0}年 第{1}周<br/>开始日期: {2} (周{4})<br />结束日期: {3} (周{5})",k,JC.Calendar.getCnNum(s.week),formatISODate(p),formatISODate(h),JC.Calendar.cnWeek.charAt(p.getDay()%7),JC.Calendar.cnWeek.charAt(h.getDay()%7));g=[];if(f.minvalue&&p.getTime()<f.minvalue.getTime()){g.push("unable")}if(f.maxvalue&&h.getTime()>f.maxvalue.getTime()){g.push("unable")}if(q.getTime()>=p.getTime()&&q.getTime()<=h.getTime()){g.push("cur")}if(u>=p.getTime()&&u<=h.getTime()){g.push("today")}v.push(printf('<td class="{0}"><a href="javascript:" title="{2}" dstart="{3}" dend="{4}" week="{1}" >{1}</a></td>',g.join(" "),s.week,r,p.getTime(),h.getTime()));if(i%8===0&&i!=j){v.push("</tr><tr>")}}v.push("</tr>");m.find("table.UTableBorder tbody").html(c(v.join("")))},lastDateObj:null,tpl:['<div id="UXCCalendar_week" class="UXCCalendar UXCCalendar_week" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};function b(k,g){var f=[],e,d=1,g=g||0,k=parseInt(k,10),h=new Date(k,0,1);h.getDay()>1&&h.setDate(h.getDate()-h.getDay()+7);g>0&&(g=(new Date(2000,1,2)-new Date(2000,1,1))*g);while(h.getFullYear()<=k){e={week:d++,start:null,end:null};e.start=h.getTime()+g;h.setDate(h.getDate()+6);e.end=h.getTime()+g;h.setDate(h.getDate()+1);if(h.getFullYear()>k){h=new Date(h.getFullYear(),0,1);if(h.getDay()<2){break}}f.push(e)}return f}c(document).delegate("#UXCCalendar_week table a","click",function(g){var d=c(this),f=new Date(),e=new Date();if(!JC.Calendar.lastIpt){return}if(d.parent("td").hasClass("unable")){return}f.setTime(d.attr("dstart"));e.setTime(d.attr("dend"));JC.Calendar.lastIpt.val(printf("{0} 至 {1}",formatISODate(f),formatISODate(e)));JC.Calendar.hide()})}(jQuery));(function(a){JC.Calendar.pickMonth=function(c){b.lastDateObj=JC.Calendar.getDate(c);JC.Calendar.lastIpt=c;JC.Calendar.setPosition(c,b.update(b.lastDateObj))};JC.Calendar.pickMonth.tpl="";var b={getLayout:function(){var c;if(!(c=a("#UXCCalendar_month")).length){c=a(JC.Calendar.pickMonth.tpl||b.tpl);c.appendTo(document.body);c.data("confirmMethod",b.onConfirm);c.data("updateYearMethod",b.updateYear);c.data("nextYearMethod",b.nextYear);c.data("preYearMethod",b.preYear)}return c},onConfirm:function(){JC.log("Calendar.pickMonth, onConfirm");var c=b.getLayout().find("td.cur");if(!c.length){b.getLayout().find("td.today")}if(c.length){c.find("a").trigger("click")}},updateYear:function(c){if(!b.lastDateObj){return}b.lastDateObj.date.setFullYear(c);JC.Calendar.updateInitYearList(b.lastDateObj);b.update(b.lastDateObj)},nextYear:function(){JC.log("nextYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()+1)},preYear:function(){JC.log("preYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()-1)},update:function(c){b.getLayout();b.updateHead(c);b.updateBody(c);return b.getLayout()},updateHead:function(d){var e=b.getLayout(),l=[],h,k,g=d.initMinvalue.getFullYear(),c=d.initMaxvalue.getFullYear();if(!k){k=d.date.getFullYear()}for(var f=g;f<=c;f++){h="";if(k===f){h=" selected "}l.push('<option value="'+f+'"'+h+">"+f+"</option>")}a(l.join("")).appendTo(e.find("select.UYear").html(""))},updateBody:function(q){var m=q.date;var k=b.getLayout();k.find("button.UYearButton").html(m.getFullYear());var o=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime();var c=[],h,d,r,f,n,g,e=m.getFullYear();var p=JC.Calendar.lastIpt,l=parseBool(p.attr("currentcanselect"));if(q.maxvalue&&l){q.maxvalue.setDate(maxDayOfMonth(q.maxvalue))}c.push("<tr>");for(i=1,j=12;i<=j;i++){f=new Date(e,i-1,1);n=new Date(e,i-1,maxDayOfMonth(f));r=printf("{0}年 {1}月<br/>开始日期: {2} (周{4})<br />结束日期: {3} (周{5})",e,JC.Calendar.getCnNum(i),formatISODate(f),formatISODate(n),JC.Calendar.cnWeek.charAt(f.getDay()%7),JC.Calendar.cnWeek.charAt(n.getDay()%7));h=[];if(q.minvalue&&f.getTime()<q.minvalue.getTime()){h.push("unable")}if(q.maxvalue&&n.getTime()>q.maxvalue.getTime()){h.push("unable")}if(m.getTime()>=f.getTime()&&m.getTime()<=n.getTime()){h.push("cur")}if(o>=f.getTime()&&o<=n.getTime()){h.push("today")}g=JC.Calendar.cnUnit.charAt(i%10);i>10&&(g="十"+g);c.push(printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}月</a></td>',h.join(" "),r,g,f.getTime(),n.getTime(),i));if(i%3===0&&i!=j){c.push("</tr><tr>")}}c.push("</tr>");k.find("table.UTableBorder tbody").html(a(c.join("")))},lastDateObj:null,tpl:['<div id="UXCCalendar_month" class="UXCCalendar UXCCalendar_week UXCCalendar_month" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};a(document).delegate("#UXCCalendar_month table a","click",function(f){var c=a(this),e=new Date(),d=new Date();if(!JC.Calendar.lastIpt){return}if(c.parent("td").hasClass("unable")){return}e.setTime(c.attr("dstart"));d.setTime(c.attr("dend"));JC.Calendar.lastIpt.val(printf("{0} 至 {1}",formatISODate(e),formatISODate(d)));JC.Calendar.hide()})}(jQuery));(function(a){JC.Calendar.pickSeason=function(c){b.lastDateObj=JC.Calendar.getDate(c);JC.Calendar.lastIpt=c;JC.Calendar.setPosition(c,b.update(b.lastDateObj))};JC.Calendar.pickSeason.tpl="";var b={getLayout:function(){var c;if(!(c=a("#UXCCalendar_season")).length){c=a(JC.Calendar.pickSeason.tpl||b.tpl);c.appendTo(document.body);c.data("confirmMethod",b.onConfirm);c.data("updateYearMethod",b.updateYear);c.data("nextYearMethod",b.nextYear);c.data("preYearMethod",b.preYear)}return c},onConfirm:function(){JC.log("Calendar.pickSeason, onConfirm");var c=b.getLayout().find("td.cur");if(!c.length){b.getLayout().find("td.today")}if(c.length){c.find("a").trigger("click")}},updateYear:function(c){if(!b.lastDateObj){return}b.lastDateObj.date.setFullYear(c);JC.Calendar.updateInitYearList(b.lastDateObj);b.update(b.lastDateObj)},nextYear:function(){JC.log("nextYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()+1)},preYear:function(){JC.log("preYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()-1)},update:function(c){b.getLayout();b.updateHead(c);b.updateBody(c);return b.getLayout()},updateHead:function(d){var e=b.getLayout(),l=[],h,k,g=d.initMinvalue.getFullYear(),c=d.initMaxvalue.getFullYear();if(!k){k=d.date.getFullYear()}for(var f=g;f<=c;f++){h="";if(k===f){h=" selected "}l.push('<option value="'+f+'"'+h+">"+f+"</option>")}a(l.join("")).appendTo(e.find("select.UYear").html(""))},updateBody:function(k){var r=k.date;var o=b.getLayout();o.find("button.UYearButton").html(r.getFullYear());var p=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime();var s=[],h,t,m,f,n,g,e=r.getFullYear();var q=JC.Calendar.lastIpt,l=parseBool(q.attr("currentcanselect"));if(k.maxvalue&&l){var c=k.maxvalue.getMonth()+1,d;if(c%3!==0){k.maxvalue.setDate(1);k.maxvalue.setMonth(c+(3-(c%3)-1))}k.maxvalue.setDate(maxDayOfMonth(k.maxvalue))}s.push("<tr>");for(i=1,j=4;i<=j;i++){f=new Date(e,i*3-3,1);n=new Date(e,i*3-1,1);n.setDate(maxDayOfMonth(n));g=JC.Calendar.cnUnit.charAt(i%10);i>10&&(g="十"+g);m=printf("{0}年 第{1}季度<br/>开始日期: {2} (周{4})<br />结束日期: {3} (周{5})",e,JC.Calendar.getCnNum(i),formatISODate(f),formatISODate(n),JC.Calendar.cnWeek.charAt(f.getDay()%7),JC.Calendar.cnWeek.charAt(n.getDay()%7));h=[];if(k.minvalue&&f.getTime()<k.minvalue.getTime()){h.push("unable")}if(k.maxvalue&&n.getTime()>k.maxvalue.getTime()){h.push("unable")}if(r.getTime()>=f.getTime()&&r.getTime()<=n.getTime()){h.push("cur")}if(p>=f.getTime()&&p<=n.getTime()){h.push("today")}s.push(printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}季度</a></td>',h.join(" "),m,g,f.getTime(),n.getTime(),i));if(i%2===0&&i!=j){s.push("</tr><tr>")}}s.push("</tr>");o.find("table.UTableBorder tbody").html(a(s.join("")))},lastDateObj:null,tpl:['<div id="UXCCalendar_season" class="UXCCalendar UXCCalendar_week UXCCalendar_season" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};a(document).delegate("#UXCCalendar_season table a","click",function(f){var c=a(this),e=new Date(),d=new Date();if(!JC.Calendar.lastIpt){return}if(c.parent("td").hasClass("unable")){return}e.setTime(c.attr("dstart"));d.setTime(c.attr("dend"));JC.Calendar.lastIpt.val(printf("{0} 至 {1}",formatISODate(e),formatISODate(d)));JC.Calendar.hide()})}(jQuery));