(function(a){window.Calendar=JC.Calendar=e;function e(f){if(e.getInstance(f)){return e.getInstance(f)}e.getInstance(f,this);var g=e.type(f);JC.log("Calendar init:",g,new Date().getTime());switch(g){case"week":this._model=new e.WeekModel(f);this._view=new e.WeekView(this._model);break;case"month":this._model=new e.MonthModel(f);this._view=new e.MonthView(this._model);break;case"season":this._model=new e.SeasonModel(f);this._view=new e.SeasonView(this._model);break;default:this._model=new e.Model(f);this._view=new e.View(this._model);break}this._init()}e.prototype={_init:function(){var f=this;f._initHanlderEvent();a([f._view,f._model]).on("BindEvent",function(g,k,h){f.on(k,h)});a([f._view,f._model]).on("TriggerEvent",function(g,k){var h=sliceArgs(arguments).slice(2);f.trigger(k,h)});f._model.init();f._view.init();return f},_initHanlderEvent:function(){var f=this;f.on(e.Model.INITED,function(g){f._model.calendarinited()&&f._model.calendarinited().call(f._model.selector(),f._model.layout(),f)});f.on(e.Model.SHOW,function(g){f._model.calendarshow()&&f._model.calendarshow().call(f._model.selector(),f._model.selector(),f)});f.on(e.Model.HIDE,function(g){f._model.calendarhide()&&f._model.calendarhide().call(f._model.selector(),f._model.selector(),f)});f.on(e.Model.UPDATE,function(h){f._model.selector()&&f._model.selector().blur();var g=sliceArgs(arguments).slice(2);f._model.calendarupdate()&&f._model.calendarupdate().apply(f._model.selector(),g)});f.on(e.Model.CLEAR,function(g){f._model.calendarclear()&&f._model.calendarclear().call(f._model.selector(),f._model.selector(),f)});f.on(e.Model.LAYOUT_CHANGE,function(g){f._model.calendarlayoutchange()&&f._model.calendarlayoutchange().call(f._model.selector(),f._model.selector(),f)});f.on(e.Model.UPDATE_MULTISELECT,function(g){f._model.calendarupdatemultiselect()&&f._model.calendarupdatemultiselect().call(f._model.selector(),f._model.selector(),f)});return f},show:function(){e.hide();e.lastIpt=this._model.selector();this._view.show();this.trigger(e.Model.SHOW);return this},hide:function(){this._view.hide();this.trigger(e.Model.HIDE);return this},selector:function(){return this._model.selector()},layout:function(){return this._model.layout()},on:function(g,f){a(this).on(g,f);return this},trigger:function(g,f){a(this).trigger(g,f);return this},updateLayout:function(){this._view.updateLayout();return this},updateSelector:function(f){e.lastIpt=f;this._model&&this._model.selector(f);return this},updateYear:function(f){this._view&&this._view.updateYear(f);this.trigger(e.Model.LAYOUT_CHANGE);return this},updateMonth:function(f){this._view&&this._view.updateMonth(f);this.trigger(e.Model.LAYOUT_CHANGE);return this},updateSelected:function(f){JC.log("JC.Calendar: updateSelector",new Date().getTime());this._view&&this._view.updateSelected(f);return this},updatePosition:function(){this._view&&this._view.updatePosition();return this},clear:function(){this._model&&this._model.selector().val("");this.trigger(e.Model.CLEAR);return this},cancel:function(){this.trigger(e.Model.CANCEL);this._view&&this._view.hide();return this},visible:function(){var g,f;this._model&&(f=this._model.layout())&&(g=f.is(":visible"));return g},defaultDate:function(f){return this._model.defaultDate(f)}};e.getInstance=function(f,h){typeof f=="string"&&!/</.test(f)&&(f=a(f));if(!(f&&f.length)||(typeof f=="string")){return}var g=e.type(f);typeof h!="undefined"&&(e._ins[g]=h);e._ins[g]&&e._ins[g].updateSelector(f);return e._ins[g]};e._ins={};e.type=function(f){f=a(f);var h,g=a.trim(f.attr("multidate")||"").toLowerCase()||a.trim(f.attr("datatype")||"").toLowerCase();switch(g){case"week":case"month":case"season":h=g;break;default:h="date";break}return h};e.isCalendar=function(f){f=a(f);var g=0;if(f.length){if(f.hasClass("UXCCalendar_btn")){g=1}if(f.prop("nodeName")&&f.attr("datatype")&&(f.prop("nodeName").toLowerCase()=="input"||f.prop("nodeName").toLowerCase()=="button")&&(f.attr("datatype").toLowerCase()=="date"||f.attr("datatype").toLowerCase()=="week"||f.attr("datatype").toLowerCase()=="month"||f.attr("datatype").toLowerCase()=="season"||f.attr("datatype").toLowerCase()=="year"||f.attr("datatype").toLowerCase()=="daterange")){g=1}if(f.prop("nodeName")&&f.attr("multidate")&&(f.prop("nodeName").toLowerCase()=="input"||f.prop("nodeName").toLowerCase()=="input")){g=1}}return g};e.isCalendarElement=function(f){return e.isCalendar(f)};e.pickDate=function(f){f=a(f);if(!(f&&f.length)){return}var g=e.getInstance(f);!g&&(g=new e(f));g.show();return};e.autoInit=true;e.defaultDateSpan=20;e.lastIpt=null;e.tpl="";e.layoutInitedCallback=null;e.layoutShowCallback=null;e.layoutHideCallback=null;e.domClickFilter=null;e.hide=function(){for(var f in e._ins){e._ins[f]&&e._ins[f].visible()&&e._ins[f].hide()}};e.getDate=function(f){return e.getInstance(f).defaultDate()};e.cnWeek="日一二三四五六";e.cnUnit="十一二三四五六七八九";e.getCnNum=function(f){var g=e.cnUnit.charAt(f%10);f>10&&(g=(f%10!==0?e.cnUnit.charAt(0):"")+g);f>19&&(g=e.cnUnit.charAt(Math.floor(f/10))+g);return g};e.position=function(f){e.getInstance(f)&&e.getInstance(f).updatePosition()};e.setPosition=e.position;e.initTrigger=function(f){f.each(function(){var h=a(this),g=(h.prop("nodeName")||"").toLowerCase();if(g!="input"){e.initTrigger(f.find(a("input[type=text]")));return}if(!(a.trim(h.attr("datatype")||"").toLowerCase()=="date"||a.trim(h.attr("multidate")||"")||a.trim(h.attr("datatype")||"").toLowerCase()=="daterange")){return}var k=h.find("+ input.UXCCalendar_btn");if(!k.length){h.after(k=a('<input type="button" class="UXCCalendar_btn"  />'))}k.data(e.Model.INPUT,h)})};e.clone=function(g,h){var f;for(f in d.prototype){g.prototype[f]=d.prototype[f]}for(f in c.prototype){h.prototype[f]=c.prototype[f]}};function d(f){this._selector=f}e.Model=d;e.Model.INPUT="CalendarInput";e.Model.INITED="CalendarInited";e.Model.SHOW="CalendarShow";e.Model.HIDE="CalendarHide";e.Model.UPDATE="CalendarUpdate";e.Model.CLEAR="CalendarClear";e.Model.CANCEL="CalendarCancel";e.Model.LAYOUT_CHANGE="CalendarLayoutChange";e.Model.UPDATE_MULTISELECT="CalendarUpdateMultiSelect";d.prototype={init:function(){return this},selector:function(f){typeof f!="undefined"&&(this._selector=f);return this._selector},layout:function(){var g=a("#UXCCalendar");if(!g.length){g=a(e.tpl||this.tpl).hide();g.attr("id","UXCCalendar").hide().appendTo(document.body);var f=a(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(g.find("select.UMonth"))}return g},startYear:function(g){var f=e.defaultDateSpan,h=g.date.getFullYear();this.selector().is("[calendardatespan]")&&(f=parseInt(this.selector().attr("calendardatespan"),10));return h-f},endYear:function(g){var f=e.defaultDateSpan,h=g.date.getFullYear();this.selector().is("[calendardatespan]")&&(f=parseInt(this.selector().attr("calendardatespan"),10));return h+f},currentcanselect:function(){var f=true;this.selector().is("[currentcanselect]")&&(currentcanselect=parseBool(this.selector().attr("currentcanselect")));return f},year:function(){return parseInt(this.layout().find("select.UYear").val(),10)||1},month:function(){return parseInt(this.layout().find("select.UMonth").val(),10)||0},day:function(){var g,f=new Date();g=this.layout().find("td.cur > a[date], td.cur > a[dstart]");if(g.length){f.setTime(g.attr("date")||g.attr("dstart"))}JC.log("dddddd",f.getDate());return f.getDate()},defaultDate:function(){var f=this,g={date:null,minvalue:null,maxvalue:null,enddate:null,multidate:null};f.selector()&&(g=f.multiselect()?f.defaultMultiselectDate(g):f.defaultSingleSelectDate(g));g.minvalue=parseISODate(f.selector().attr("minvalue"));g.maxvalue=parseISODate(f.selector().attr("maxvalue"));return g},defaultSingleSelectDate:function(k){var f=this,g=f.selector(),h;if(h=parseISODate(g.val())){k.date=h}else{if(g.val()&&(h=g.val().replace(/[^\d]/g,"")).length==16){k.date=parseISODate(h.slice(0,8));k.enddate=parseISODate(h.slice(8))}else{h=new Date();k.date=new Date(h.getFullYear(),h.getMonth(),h.getDate())}}return k},defaultMultiselectDate:function(g){var f=this;return g},layoutDate:function(){return this.multiselect()?this.multiLayoutDate():this.singleLayoutDate()},singleLayoutDate:function(){var f=this,k=f.defaultDate(),h=this.day(),g;k.date.setDate(1);k.date.setFullYear(this.year());k.date.setMonth(this.month());g=maxDayOfMonth(k.date);h>g&&(h=g);k.date.setDate(h);return k},multiLayoutDate:function(){JC.log("Calendar.Model multiLayoutDate",new Date().getTime())},selectedDate:function(){var h,g,f;g=this.layout().find("td.cur");g.length&&!g.hasClass("unable")&&(f=g.find("a[date]"))&&(h=new Date(),h.setTime(f.attr("date")));return h},multiselectDate:function(){var f=[];return f},calendarinited:function(){var h=this.selector(),g=e.layoutInitedCallback,f;h&&h.attr("calendarinited")&&(f=window[h.attr("calendarinited")])&&(g=f);return g},calendarshow:function(){var h=this.selector(),g=e.layoutShowCallback,f;h&&h.attr("calendarshow")&&(f=window[h.attr("calendarshow")])&&(g=f);return g},calendarhide:function(){var h=this.selector(),g=e.layoutHideCallback,f;h&&h.attr("calendarhide")&&(f=window[h.attr("calendarhide")])&&(g=f);return g},calendarupdate:function(h){var k=this.selector(),g,f;k&&k.attr("calendarupdate")&&(f=window[k.attr("calendarupdate")])&&(g=f);return g},calendarclear:function(){var h=this.selector(),g,f;h&&h.attr("calendarclear")&&(f=window[h.attr("calendarclear")])&&(g=f);return g},calendarlayoutchange:function(){var h=this.selector(),g,f;h&&h.attr("calendarlayoutchange")&&(f=window[h.attr("calendarlayoutchange")])&&(g=f);return g},multiselect:function(){var f;this.selector().is("[multiselect]")&&(f=parseBool(this.selector().attr("multiselect")));return f},calendarupdatemultiselect:function(h){var k=this.selector(),g,f;k&&k.attr("calendarupdatemultiselect")&&(f=window[k.attr("calendarupdatemultiselect")])&&(g=f);return g},tpl:['<div id="UXCCalendar" class="UXCCalendar">','    <div class="UHeader">','        <select class="UYear"></select>','        <img class="UImg yearctl" align="absMiddle" usemap="#UXCCalendar_Year" />','        <map name="UXCCalendar_Year"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>','        <select class="UMonth"></select>','        <img class="UImg monthctl" align="absMiddle" usemap="#UXCCalendar_Month"  />','        <map name="UXCCalendar_Month"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>',"    </div>",'    <table class="UTable">',"        <thead>","            <tr>","                <th>一</th>","                <th>二</th>","                <th>三</th>","                <th>四</th>","                <th>五</th>","                <th>六</th>","                <th>日</th>","            </tr>","        </thead>","   </table>",'   <table class="UTable UTableBorder">',"        <tbody>","           <!--<tr>",'                <td class="cur"><a href="#">2</a></td>','                <td class="unable"><a href="#">2</a></td>','                <td class="weekend cur"><a href="#">6</a></td>','                <td class="weekend hover"><a href="#">13</a></td>','                <td class="weekend other"><a href="#">41</a></td>','                <td class="weekend other"><a href="#">42</a></td>',"            </tr>-->","        </tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};function c(f){this._model=f}e.View=c;c.prototype={init:function(){return this},hide:function(){this._model.layout().hide()},show:function(){var f=this._model.defaultDate();JC.log("Calendar.View: show",new Date().getTime(),formatISODate(f.date));this._buildLayout(f);this._buildDone()},updateLayout:function(f){typeof f=="undefined"&&(f=this._model.layoutDate());this._buildLayout(f);this._buildDone()},updateYear:function(f){if(typeof f=="undefined"||f==0){return}this._model.multiselect()?this.updateMultiYear(f):this.updateSingleYear(f)},updateSingleYear:function(g){var k=this._model.layoutDate(),h=k.date.getDate(),f;k.date.setDate(1);k.date.setFullYear(k.date.getFullYear()+g);f=maxDayOfMonth(k.date);h>f&&(h=f);k.date.setDate(h);this._buildLayout(k);this._buildDone()},updateMultiYear:function(f){},updateMonth:function(g){if(typeof g=="undefined"||g==0){return}var k=this._model.layoutDate(),h=k.date.getDate(),f;k.date.setDate(1);k.date.setMonth(k.date.getMonth()+g);f=maxDayOfMonth(k.date);h>f&&(h=f);k.date.setDate(h);this._buildLayout(k);this._buildDone()},updateSelected:function(k){var f=this,g,h;if(!k){g=this._model.selectedDate()}else{k=a(k);h=getJqParent(k,"td");if(h&&h.hasClass("unable")){return}g=new Date();g.setTime(k.attr("date"))}if(!g){return}f._model.selector().val(formatISODate(g));a(f).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"date",g,g]);e.hide()},updatePosition:function(){var h=this,f=h._model.selector(),t=h._model.layout();if(!(f&&t&&f.length&&t.length)){return}t.css({left:"-9999px",top:"-9999px","z-index":ZINDEX_COUNT++}).show();var r=t.width(),l=t.height(),s=f.width(),m=f.height(),q=f.offset(),p,n,g=a(window).width(),o=a(window).height(),k=a(document).scrollTop();p=q.left;n=q.top+m+5;if((n+l-k)>o){JC.log("y overflow");n=q.top-l-3;if(n<k){n=k}}t.css({left:p+"px",top:n+"px"});JC.log(r,l,s,m,q.left,q.top,g,o);JC.log(k,p,n)},_buildDone:function(){this.updatePosition();a(this).trigger("TriggerEvent",[e.Model.INITED])},_buildLayout:function(f){this._model.layout();if(!(f&&f.date)){return}this._buildHeader(f);this._buildBody(f);this._buildFooter(f)},_buildHeader:function(k){var g=this,p=g._model.layout(),f=[],n,l=l=k.date.getFullYear(),m=g._model.startYear(k),o=g._model.endYear(k);JC.log(m,o);for(var h=m;h<=o;h++){f.push(printf('<option value="{0}"{1}>{0}</option>',h,h===l?" selected":""))}a(f.join("")).appendTo(p.find("select.UYear").html(""));a(p.find("select.UMonth").val(k.date.getMonth()))},_buildBody:function(o){var h=this,w=h._model.layout();var v=maxDayOfMonth(o.date),q=o.date.getDay()||7,u=q+v,l=6,g=[],k,f,s,n,p;var m=new Date(o.date.getFullYear(),o.date.getMonth(),1);var r=m.getDay()||7;if(r<2){m.setDate(-(r-1+6))}else{m.setDate(-(r-2))}var t=new Date();if(o.maxvalue&&!h._model.currentcanselect()){o.maxvalue.setDate(o.maxvalue.getDate()-1)}g.push("<tr>");for(n=1;n<=42;n++){p=[];if(m.getDay()===0||m.getDay()==6){p.push("weekend")}if(!isSameMonth(o.date,m)){p.push("other")}if(o.minvalue&&m.getTime()<o.minvalue.getTime()){p.push("unable")}if(o.maxvalue&&m.getTime()>o.maxvalue.getTime()){p.push("unable")}if(isSameDay(m,t)){p.push("today")}if(isSameDay(o.date,m)){p.push("cur")}g.push('<td class="',p.join(" "),'">','<a href="javascript:" date="',m.getTime(),'" title="'+formatISODate(m)+'" >',m.getDate(),"</a></td>");m.setDate(m.getDate()+1);if(n%7===0&&n!=42){g.push("</tr><tr>")}}g.push("</tr>");w.find("table.UTableBorder tbody").html(a(g.join("")))},_buildFooter:function(f){}};var b={};a(document).delegate("body > div.UXCCalendar select.UYear, #UXCCalendar select.UMonth","change",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateLayout()});a(document).delegate("body > div.UXCCalendar button.UNextYear","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateYear(1)});a(document).delegate("body > div.UXCCalendar button.UPreYear","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateYear(-1)});a(document).delegate("map[name=UXCCalendar_Year] area","click",function(g){g.preventDefault();var f=a(this),h=e.getInstance(e.lastIpt);f.attr("action")&&h&&(f.attr("action").toLowerCase()=="up"&&h.updateYear(1),f.attr("action").toLowerCase()=="down"&&h.updateYear(-1))});a(document).delegate("map[name=UXCCalendar_Month] area","click",function(g){g.preventDefault();var f=a(this),h=e.getInstance(e.lastIpt);f.attr("action")&&h&&(f.attr("action").toLowerCase()=="up"&&h.updateMonth(1),f.attr("action").toLowerCase()=="down"&&h.updateMonth(-1))});a(document).delegate("div.UXCCalendar table a[date], div.UXCCalendar table a[dstart]","click",function(f){f.preventDefault();e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateSelected(a(this))});a(document).delegate("body > div.UXCCalendar button.UConfirm","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).updateSelected()});a(document).delegate("body > div.UXCCalendar button.UClear","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).clear()});a(document).delegate("body > div.UXCCalendar button.UCancel","click",function(f){e.getInstance(e.lastIpt)&&e.getInstance(e.lastIpt).cancel()});a(document).delegate("input.UXCCalendar_btn","click",function(f){a(this).data(e.Model.INPUT)&&e.pickDate(a(this).data(e.Model.INPUT))});a(document).delegate("body > div.UXCCalendar","click",function(f){f.stopPropagation()});a(document).ready(function(f){setTimeout(function(h){if(!e.autoInit){return}e.initTrigger(a("input[type=text]"))},200);a(window).on("scroll resize",function(h){var k=e.getInstance(e.lastIpt);k&&k.visible()&&k.updatePosition()});var g=null;a(document).on("click",function(h){var k=h.target||h.srcElement;if(e.domClickFilter){if(e.domClickFilter(a(k))===false){return}}if(e.isCalendar(h.target||h.targetElement)){return}if(k&&(k.nodeName.toLowerCase()!="input"&&k.nodeName.toLowerCase()!="button")){e.hide();return}g&&clearTimeout(g);g=setTimeout(function(){if(e.lastIpt&&e.lastIpt.length&&k==e.lastIpt[0]){return}e.hide()},100)})});a(document).delegate(["input[datatype=season]","input[datatype=month]","input[datatype=week]","input[datatype=date]","input[datatype=daterange]","input[multidate]"].join(),"focus",function(f){e.pickDate(this)});a(document).delegate(["button[datatype=season]","button[datatype=month]","button[datatype=week]","button[datatype=date]","button[datatype=daterange]","button[multidate]"].join(),"click",function(f){e.pickDate(this)})}(jQuery));(function(d){JC.Calendar.weekTpl="";JC.Calendar.weekDayOffset=1;function b(e){this._selector=e}JC.Calendar.WeekModel=b;function a(e){this._model=e}JC.Calendar.WeekView=a;JC.Calendar.clone(b,a);b.prototype.layout=function(){var e=d("#UXCCalendar_week");if(!e.length){e=d(JC.Calendar.weekTpl||this.tpl).hide();e.attr("id","UXCCalendar_week").hide().appendTo(document.body)}return e};b.prototype.tpl=['<div id="UXCCalendar_week" class="UXCCalendar UXCCalendar_week" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("");b.prototype.month=function(){var g=0,f,e=new Date();(f=this.layout().find("td.cur a[dstart]")).length&&(e=new Date())&&(e.setTime(f.attr("dstart")));g=e.getMonth();return g};b.prototype.selectedDate=function(){var g,f,e;f=this.layout().find("td.cur");f.length&&!f.hasClass("unable")&&(e=f.find("a[dstart]"))&&(g={start:new Date(),end:new Date()},g.start.setTime(e.attr("dstart")),g.end.setTime(e.attr("dend")));return g};b.prototype.singleLayoutDate=function(){var f=this,k=f.defaultDate(),h=this.day(),g,e=f.layout().find("td.cur > a[week]");k.date.setDate(1);k.date.setFullYear(this.year());k.date.setMonth(this.month());g=maxDayOfMonth(k.date);h>g&&(h=g);k.date.setDate(h);e.length&&(k.curweek=parseInt(e.attr("week"),10));JC.log("WeekModel.singleLayoutDate:",e.length,k.curweek);return k};a.prototype._buildBody=function(w){var y=this,o=w.date,k=y._model.layout(),u=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),l=c(o.getFullYear(),JC.Calendar.weekDayOffset),t=c(o.getFullYear()+1,JC.Calendar.weekDayOffset),m=0,v=[],g,q,p,n,s,h=o.getFullYear(),f=Math.ceil(l.length/8),r=JC.Calendar.lastIpt,e=parseBool(r.attr("currentcanselect"));if(w.maxvalue&&e){var x=w.maxvalue.getDay();if(x>0){w.maxvalue.setDate(w.maxvalue.getDate()+(7-x))}}v.push("<tr>");for(i=1,j=f*8;i<=j;i++){q=l[i-1];if(!q){q=t[m++];h=o.getFullYear()+1}n=new Date();s=new Date();n.setTime(q.start);s.setTime(q.end);p=printf("{0}年 第{1}周\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",h,JC.Calendar.getCnNum(q.week),formatISODate(n),formatISODate(s),JC.Calendar.cnWeek.charAt(n.getDay()%7),JC.Calendar.cnWeek.charAt(s.getDay()%7));g=[];if(w.minvalue&&n.getTime()<w.minvalue.getTime()){g.push("unable")}if(w.maxvalue&&s.getTime()>w.maxvalue.getTime()){g.push("unable")}if(w.curweek){if(q.week==w.curweek&&o.getFullYear()==n.getFullYear()){g.push("cur")}}else{if(o.getTime()>=n.getTime()&&o.getTime()<=s.getTime()){g.push("cur")}}if(u>=n.getTime()&&u<=s.getTime()){g.push("today")}v.push(printf('<td class="{0}"><a href="javascript:" title="{2}" dstart="{3}" dend="{4}" week="{1}" date="{5}" >{1}</a></td>',g.join(" "),q.week,p,n.getTime(),s.getTime(),w.date.getTime()));if(i%8===0&&i!=j){v.push("</tr><tr>")}}v.push("</tr>");k.find("table.UTableBorder tbody").html(d(v.join("")))};a.prototype.updateSelected=function(k){var e=this,f,h,g;if(!k){g=this._model.selectedDate();g&&(f=g.start,h=g.end)}else{k=d(k);g=getJqParent(k,"td");if(g&&g.hasClass("unable")){return}f=new Date();h=new Date();f.setTime(k.attr("dstart"));h.setTime(k.attr("dend"))}if(!(f&&h)){return}e._model.selector().val(printf("{0} 至 {1}",formatISODate(f),formatISODate(h)));d(e).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"week",f,h]);JC.Calendar.hide()};function c(h,g){var l=[],k,f=1,g=g||0,h=parseInt(h,10),e=new Date(h,0,1);e.getDay()>1&&e.setDate(e.getDate()-e.getDay()+7);g>0&&(g=(new Date(2000,1,2)-new Date(2000,1,1))*g);while(e.getFullYear()<=h){k={week:f++,start:null,end:null};k.start=e.getTime()+g;e.setDate(e.getDate()+6);k.end=e.getTime()+g;e.setDate(e.getDate()+1);if(e.getFullYear()>h){e=new Date(e.getFullYear(),0,1);if(e.getDay()<2){break}}l.push(k)}return l}}(jQuery));(function(c){JC.Calendar.monthTpl="";function a(e){this._selector=e}JC.Calendar.MonthModel=a;function d(e){this._model=e}JC.Calendar.MonthView=d;JC.Calendar.clone(a,d);a.prototype.layout=function(){var e=c("#UXCCalendar_month");if(!e.length){e=c(JC.Calendar.monthTpl||this.tpl).hide();e.attr("id","UXCCalendar_month").hide().appendTo(document.body)}return e};a.prototype.tpl=['<div id="UXCCalendar_month" class="UXCCalendar UXCCalendar_week UXCCalendar_month" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("");a.prototype.month=function(){var g=0,f,e;(f=this.layout().find("td.cur a[dstart]")).length&&(e=new Date())&&(e.setTime(f.attr("dstart")),g=e.getMonth());return g};a.prototype.selectedDate=function(){var g,f,e;f=this.layout().find("td.cur");f.length&&!f.hasClass("unable")&&(e=f.find("a[dstart]"))&&(g={start:new Date(),end:new Date()},g.start.setTime(e.attr("dstart")),g.end.setTime(e.attr("dend")));return g};a.prototype.defaultMultiselectDate=function(m){var e=this,f=e.selector(),k,g,h,l;if(k=parseISODate(f.val())){m.date=k}else{if(f.val()&&(k=f.val().replace(/[^\d,]/g,"")).length){k=k.split(",");g=[];c.each(k,function(o,n){if(n.length!=16){return}h=parseISODate(n.slice(0,8));l=parseISODate(n.slice(8));if(!o){m.date=cloneDate(h);m.enddate=cloneDate(l)}g.push({start:h,end:l})});m.multidate=g}else{k=new Date();m.date=new Date(k.getFullYear(),k.getMonth(),k.getDate());m.enddate=cloneDate(m.date);m.enddate.setDate(maxDayOfMonth(m.enddate));m.multidate=[];m.multidate.push({start:cloneDate(m.date),end:cloneDate(m.enddate)})}}return m};a.prototype.multiLayoutDate=function(){var e=this,g=e.defaultDate(),f=e.year();JC.log("MonthModel.multiLayoutDate:",new Date().getTime());g.multidate=[];e.layout().find("td.cur").each(function(){var h=c(this);var l=h.find("> a[dstart]"),k=new Date(),m=new Date();k.setTime(l.attr("dstart"));m.setTime(l.attr("dend"));g.multidate.push({start:k,end:m})});g.date.setFullYear(f);g.enddate.setFullYear(f);c.each(g.multidate,function(k,h){h.start.setFullYear(f);h.end.setFullYear(f)});return g};d.prototype.updateMultiYear=function(f){var h=this._model.layoutDate(),g,e;JC.log("MonthView.updateMultiYear:",new Date().getTime());b(h.date,f);b(h.enddate,f);if(h.multidate){c.each(h.multidate,function(l,k){b(k.start,f);b(k.end,f);JC.log("xxxxxxxxxxxxxxxxxxxxxxx",k.start,k.end,f)})}this._buildLayout(h);this._buildDone()};function b(f,g){var h,e;h=f.getDate();f.setDate(1);f.setFullYear(f.getFullYear()+g);e=maxDayOfMonth(f);h>e&&(h=e);f.setDate(h)}d.prototype._buildBody=function(l){var f=this,w=l.date,v=f._model.layout(),p=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),m=0,e=[],n,g,t,h,u,k=w.getFullYear(),r=4,s=JC.Calendar.lastIpt,o=parseBool(s.attr("currentcanselect")),q=l.multidate?l.multidate.slice():null;if(l.maxvalue&&o){l.maxvalue.setDate(maxDayOfMonth(l.maxvalue))}e.push("<tr>");for(i=1,j=12;i<=j;i++){h=new Date(k,i-1,1);u=new Date(k,i-1,maxDayOfMonth(h));t=printf("{0}年 {1}月<br/>开始日期: {2} (周{4})<br />结束日期: {3} (周{5})",k,JC.Calendar.getCnNum(i),formatISODate(h),formatISODate(u),JC.Calendar.cnWeek.charAt(h.getDay()%7),JC.Calendar.cnWeek.charAt(u.getDay()%7));n=[];if(l.minvalue&&h.getTime()<l.minvalue.getTime()){n.push("unable")}if(l.maxvalue&&u.getTime()>l.maxvalue.getTime()){n.push("unable")}if(q){c.each(q,function(y,x){if(h.getTime()>=x.start.getTime()&&h.getTime()<=x.end.getTime()){n.push("cur");q.splice(y,1);return false}})}else{if(w.getTime()>=h.getTime()&&w.getTime()<=u.getTime()){n.push("cur")}}if(p>=h.getTime()&&p<=u.getTime()){n.push("today")}_cnUnit=JC.Calendar.cnUnit.charAt(i%10);i>10&&(_cnUnit="十"+_cnUnit);e.push(printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}月</a></td>',n.join(" "),t,_cnUnit,h.getTime(),u.getTime(),i));if(i%3===0&&i!=j){e.push("</tr><tr>")}}e.push("</tr>");v.find("table.UTableBorder tbody").html(c(e.join("")))};a.prototype.multiselectDate=function(){var e=this,l=[],f,h,g,k;e.layout().find("td.cur").each(function(){f=c(this);h=f.find("> a[dstart]");if(f.hasClass("unable")){return}g=new Date();k=new Date();g.setTime(h.attr("dstart"));k.setTime(h.attr("dend"));l.push({start:g,end:k})});return l};d.prototype.updateSelected=function(m){var e=this,f,l,g,k,h;if(!m){if(e._model.multiselect()){g=this._model.multiselectDate();if(!g.length){return}h=[];c.each(g,function(o,n){h.push(printf("{0} 至 {1}",formatISODate(n.start),formatISODate(n.end)))});k=h.join(",")}else{g=this._model.selectedDate();g&&(f=g.start,l=g.end);f&&l&&(k=printf("{0} 至 {1}",formatISODate(f),formatISODate(l)))}}else{m=c(m);g=getJqParent(m,"td");if(g&&g.hasClass("unable")){return}if(e._model.multiselect()){g.toggleClass("cur");return}f=new Date();l=new Date();f.setTime(m.attr("dstart"));l.setTime(m.attr("dend"));k=printf("{0} 至 {1}",formatISODate(f),formatISODate(l))}if(!k){return}e._model.selector().val(k);c(e).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"month",f,l]);JC.Calendar.hide()}}(jQuery));(function(c){JC.Calendar.seasonTpl="";function b(d){this._selector=d}JC.Calendar.SeasonModel=b;function a(d){this._model=d}JC.Calendar.SeasonView=a;JC.Calendar.clone(b,a);b.prototype.layout=function(){var d=c("#UXCCalendar_season");if(!d.length){d=c(JC.Calendar.seasonTpl||this.tpl).hide();d.attr("id","UXCCalendar_season").hide().appendTo(document.body)}return d};b.prototype.tpl=['<div id="UXCCalendar_season" class="UXCCalendar UXCCalendar_week UXCCalendar_season" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("");b.prototype.month=function(){var f=0,e,d;(e=this.layout().find("td.cur a[dstart]")).length&&(d=new Date())&&(d.setTime(e.attr("dstart")),f=d.getMonth());return f};b.prototype.selectedDate=function(){var f,e,d;e=this.layout().find("td.cur");e.length&&!e.hasClass("unable")&&(d=e.find("a[dstart]"))&&(f={start:new Date(),end:new Date()},f.start.setTime(d.attr("dstart")),f.end.setTime(d.attr("dend")));return f};a.prototype._buildBody=function(v){var w=this,n=v.date,k=w._model.layout(),t=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime(),l=0,u=[],g,q,p,m,s,h=n.getFullYear(),f=4,r=JC.Calendar.lastIpt,d=parseBool(r.attr("currentcanselect"));if(v.maxvalue&&d){var e=v.maxvalue.getMonth()+1,o;if(e%3!==0){v.maxvalue.setDate(1);v.maxvalue.setMonth(e+(3-(e%3)-1))}v.maxvalue.setDate(maxDayOfMonth(v.maxvalue))}u.push("<tr>");for(i=1,j=4;i<=j;i++){m=new Date(h,i*3-3,1);s=new Date(h,i*3-1,1);s.setDate(maxDayOfMonth(s));_cnUnit=JC.Calendar.cnUnit.charAt(i%10);i>10&&(_cnUnit="十"+_cnUnit);p=printf("{0}年 第{1}季度<br/>开始日期: {2} (周{4})<br />结束日期: {3} (周{5})",h,JC.Calendar.getCnNum(i),formatISODate(m),formatISODate(s),JC.Calendar.cnWeek.charAt(m.getDay()%7),JC.Calendar.cnWeek.charAt(s.getDay()%7));g=[];if(v.minvalue&&m.getTime()<v.minvalue.getTime()){g.push("unable")}if(v.maxvalue&&s.getTime()>v.maxvalue.getTime()){g.push("unable")}if(n.getTime()>=m.getTime()&&n.getTime()<=s.getTime()){g.push("cur")}if(t>=m.getTime()&&t<=s.getTime()){g.push("today")}u.push(printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}季度</a></td>',g.join(" "),p,_cnUnit,m.getTime(),s.getTime(),i));if(i%2===0&&i!=j){u.push("</tr><tr>")}}u.push("</tr>");k.find("table.UTableBorder tbody").html(c(u.join("")))};a.prototype.updateSelected=function(h){var d=this,e,g,f;if(!h){f=this._model.selectedDate();f&&(e=f.start,g=f.end)}else{h=c(h);f=getJqParent(h,"td");if(f&&f.hasClass("unable")){return}e=new Date();g=new Date();e.setTime(h.attr("dstart"));g.setTime(h.attr("dend"))}if(!(e&&g)){return}d._model.selector().val(printf("{0} 至 {1}",formatISODate(e),formatISODate(g)));c(d).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"season",e,g]);JC.Calendar.hide()}}(jQuery));